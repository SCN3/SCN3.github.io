<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>scn3&#39;s realm</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="scn3's realm">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="scn3's realm">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="scn3's realm">
<meta name="twitter:description">
  
    <link rel="alternate" href="/atom.xml" title="scn3&#39;s realm" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">scn3&#39;s realm</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="Flux RSS"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Rechercher"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-a-python-code-shippet" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/04/a-python-code-shippet/" class="article-date">
  <time datetime="2018-04-04T22:13:56.000Z" itemprop="datePublished">2018-04-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/04/a-python-code-shippet/">a python code shippet</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="a-python-code-snippet"><a href="#a-python-code-snippet" class="headerlink" title="a python code snippet"></a>a python code snippet</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br></pre></td><td class="code"><pre><span class="line">CONFEDERATION_COUNT = <span class="number">6</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Domain</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""Domain of Variables</span><br><span class="line">    </span><br><span class="line">    i.e. domain of which group a country can belong to in this assignment</span><br><span class="line">    Use Bit-operation to implement rather than list</span><br><span class="line">    Class Attributes:</span><br><span class="line">        size: An integer indicating the size of domains</span><br><span class="line">    Instance Attributes:</span><br><span class="line">        remained: An integer indicating how many value remained in the domain</span><br><span class="line">        last_change: An integer indicating the search step where the domain changed most recently,</span><br><span class="line">            which can be used to backjump to avoid unnecessary steps</span><br><span class="line">    """</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init</span><span class="params">(cls, size)</span>:</span></span><br><span class="line">        cls.size = size</span><br><span class="line">        cls.__full_domain = (<span class="number">1</span> &lt;&lt; size) - <span class="number">1</span>  <span class="comment"># A integer indicating what's value in domain when it's full</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.__val = Domain.__full_domain  <span class="comment"># A integer indicating the values in domain</span></span><br><span class="line">        self.remained = Domain.size</span><br><span class="line">        self.last_change = <span class="number">-1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_val</span><span class="params">(self, val)</span>:</span></span><br><span class="line">        <span class="string">"""Sets a value for domain, i.e. selects a value and deletes all others"""</span></span><br><span class="line">        self.__val = <span class="number">1</span> &lt;&lt; val</span><br><span class="line">        self.remained = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">retrieve</span><span class="params">(self, val, remained)</span>:</span></span><br><span class="line">        <span class="string">"""Retrieves domain to what it is before running AC-3 alg and searching deeper"""</span></span><br><span class="line">        self.__val = val</span><br><span class="line">        self.remained = remained</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_values</span><span class="params">(self, bits=False)</span>:</span></span><br><span class="line">        <span class="string">"""Gets values which are still in domain</span><br><span class="line">        </span><br><span class="line">        :param bits: A boolean indicating whether return in bits format or list</span><br><span class="line">        :return: The values, in format of a integer or a list of integer</span><br><span class="line">        """</span></span><br><span class="line">        <span class="keyword">if</span> bits:</span><br><span class="line">            <span class="keyword">return</span> self.__val</span><br><span class="line">        values_list = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(Domain.size):</span><br><span class="line">            <span class="keyword">if</span> (<span class="number">1</span> &lt;&lt; i) &amp; self.__val &gt; <span class="number">0</span>:</span><br><span class="line">                values_list.append(i)</span><br><span class="line">        <span class="keyword">return</span> values_list</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">revise</span><span class="params">(self, other_domain, assigned_step)</span>:</span></span><br><span class="line">        <span class="string">"""Revise domain in the process of AC-3 alg</span><br><span class="line">        </span><br><span class="line">        :param other_domain: A class domain indicating a domain which has constraint with this domain</span><br><span class="line">        :param assigned_step: A integer indicating the step of our MAC searching alg</span><br><span class="line">        :return: A bool, True if the domain is revised, False if not</span><br><span class="line">        """</span></span><br><span class="line">        revised = <span class="keyword">False</span></span><br><span class="line">        other_val = other_domain.get_values(<span class="keyword">True</span>)</span><br><span class="line">        list_val = self.get_values()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> list_val:</span><br><span class="line">            <span class="comment"># Checks if value i is consistent with the other domain using Bit-operation</span></span><br><span class="line">            <span class="keyword">if</span> Domain.__full_domain - (<span class="number">1</span> &lt;&lt; i) &amp; other_val == <span class="number">0</span>:</span><br><span class="line">                revised = <span class="keyword">True</span></span><br><span class="line">                self.__val -= (<span class="number">1</span> &lt;&lt; i)  <span class="comment"># Revises domain actually</span></span><br><span class="line">                self.remained -= <span class="number">1</span></span><br><span class="line">                self.last_change = assigned_step  <span class="comment"># Record the step of MAC alg</span></span><br><span class="line">        <span class="keyword">return</span> revised</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reduce</span><span class="params">(self, val, assigned_step)</span>:</span></span><br><span class="line">        <span class="string">"""Reduce a value in domain if the domain has that value</span><br><span class="line">        </span><br><span class="line">        :param val: An integer indicating the value to be reduced</span><br><span class="line">        :param assigned_step: A integer indicating the step of our MAC searching alg</span><br><span class="line">        """</span></span><br><span class="line">        <span class="keyword">if</span> self.__val &amp; (<span class="number">1</span> &lt;&lt; val) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        self.__val -= (<span class="number">1</span> &lt;&lt; val)</span><br><span class="line">        self.remained -= <span class="number">1</span></span><br><span class="line">        self.last_change = assigned_step</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Variable</span>:</span></span><br><span class="line">    <span class="string">"""A class describing and recording the info of each variable</span><br><span class="line">    </span><br><span class="line">    Class Attributes:</span><br><span class="line">        count: An integer indicating how many variables totally</span><br><span class="line">        dict: A dict connecting a variable's name and its number(in order of being created)</span><br><span class="line">    Instance Attributes:</span><br><span class="line">        name: A string indicating the name of the variable</span><br><span class="line">        domain: A instance of class Domain indicating the info of this variable's domain</span><br><span class="line">        belong_uefa: A bool, True if the country that variable represent belongs to UEFA confederation, False if not</span><br><span class="line">        constraint: A list of integer indicating which variables have constraints with this variable</span><br><span class="line">        assigned: A bool, True if this variable if assigned, False if not</span><br><span class="line">    """</span></span><br><span class="line"></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    dict = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.domain = Domain()</span><br><span class="line">        self.belong_uefa = <span class="keyword">False</span></span><br><span class="line">        self.constraint = []</span><br><span class="line">        self.assigned = <span class="keyword">False</span></span><br><span class="line">        Variable.dict[name] = Variable.count</span><br><span class="line">        Variable.count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">assign</span><span class="params">(self, val)</span>:</span></span><br><span class="line">        <span class="string">"""Assigns the value 'val' to this variable"""</span></span><br><span class="line">        self.assigned = <span class="keyword">True</span></span><br><span class="line">        self.domain.set_val(val)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_result</span><span class="params">(variables=None, no_solution=True)</span>:</span></span><br><span class="line">    <span class="string">"""Prints result to 'output.txt' file and exit"""</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'output.txt'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> output_file:</span><br><span class="line">        <span class="keyword">if</span> no_solution:</span><br><span class="line">            <span class="keyword">print</span> &gt;&gt; output_file, <span class="string">'No'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> &gt;&gt; output_file, <span class="string">'Yes'</span></span><br><span class="line">            groups = [[] <span class="keyword">for</span> i <span class="keyword">in</span> range(Domain.size)]</span><br><span class="line">            <span class="keyword">for</span> var_itr <span class="keyword">in</span> variables:</span><br><span class="line">                groups[var_itr.domain.get_values()[<span class="number">0</span>]].append(var_itr.name)</span><br><span class="line">            <span class="keyword">for</span> group <span class="keyword">in</span> groups:</span><br><span class="line">                <span class="keyword">if</span> len(group) == <span class="number">0</span>:</span><br><span class="line">                    str_out = <span class="string">'None'</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    str_out = group[<span class="number">0</span>]</span><br><span class="line">                    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, len(group)):</span><br><span class="line">                        str_out = str_out + <span class="string">','</span> + group[j]</span><br><span class="line">                <span class="keyword">print</span> &gt;&gt; output_file, str_out</span><br><span class="line">    exit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_constraint_queue</span><span class="params">(variables, related_var=<span class="number">-1</span>)</span>:</span></span><br><span class="line">    <span class="string">"""Generates a queue recording pairs of variables with binary constraint</span><br><span class="line">    </span><br><span class="line">    :param variables: A list of instances Variable indicating all variables in this problem</span><br><span class="line">    :param related_var: An integer indicating the variable that is considered to update this queue, -1 if all variables</span><br><span class="line">    :return: A list of [integer, integer] indicating the constraint queue which will be used in AC-3 alg</span><br><span class="line">    """</span></span><br><span class="line">    constraint_queue = []</span><br><span class="line">    <span class="keyword">if</span> related_var == <span class="number">-1</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(Variable.count):</span><br><span class="line">            constraint_queue.extend(generate_constraint_queue(variables, i))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> variables[related_var].constraint:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> variables[i].assigned:  <span class="comment"># Only considers unassigned variables</span></span><br><span class="line">                constraint_queue.append([i, related_var])</span><br><span class="line">    <span class="keyword">return</span> constraint_queue</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ac3</span><span class="params">(variables, constraint_queue, assigned_step=<span class="number">-1</span>)</span>:</span></span><br><span class="line">    <span class="string">"""AC-3 alg to reduce the domains of each variable</span><br><span class="line">    </span><br><span class="line">    :param variables: A list of instances Variable indicating all variables in this problem</span><br><span class="line">    :param constraint_queue: A list of [integer, integer] recording the info of pairs of variables with 2-constraint</span><br><span class="line">    :param assigned_step: A integer indicating the step of our MAC searching alg</span><br><span class="line">    :return: False if no solution, else True</span><br><span class="line">    """</span></span><br><span class="line">    <span class="keyword">while</span> len(constraint_queue) &gt; <span class="number">0</span>:</span><br><span class="line">        constraint = constraint_queue.pop(<span class="number">0</span>)</span><br><span class="line">        variable = variables[constraint[<span class="number">0</span>]]</span><br><span class="line">        <span class="keyword">if</span> variable.domain.revise(variables[constraint[<span class="number">1</span>]].domain, assigned_step):</span><br><span class="line">            <span class="keyword">if</span> variable.domain.get_values(<span class="keyword">True</span>) == <span class="number">0</span>:  <span class="comment"># Empty domain -&gt; no solution</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> variable.constraint:</span><br><span class="line">                <span class="keyword">if</span> i != constraint[<span class="number">1</span>] <span class="keyword">and</span> <span class="keyword">not</span> variables[i].assigned:</span><br><span class="line">                    constraint_queue.append([i, constraint[<span class="number">0</span>]])</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mac</span><span class="params">(variables, assigned, group_uefa_cnt)</span>:</span></span><br><span class="line">    <span class="string">"""MAC(Maintaining Arc Consistency) alg for search</span><br><span class="line">    </span><br><span class="line">    In each step, chooses a unassigned variable using MRV(Minimum-remaining-values) heuristic,</span><br><span class="line">    and deals with UEFA situation(no more than 1 UEFA countries in one group), and then runs </span><br><span class="line">    AC-3 alg to reduce domain of unassigned variables and check if no solution, and then backjumps</span><br><span class="line">    to the most recent step causing the change of the current variable's domain</span><br><span class="line">    :param variables: A list of instances Variable indicating all variables in this problem</span><br><span class="line">    :param assigned: An integer indicating how many variables have been assigned</span><br><span class="line">    :param group_uefa_cnt: A list of integer indicating how many countries in UEFA have been assigned to a group</span><br><span class="line">    :return: An integer indicating which assigned step should be backjumped to</span><br><span class="line">    """</span></span><br><span class="line">    <span class="keyword">if</span> assigned == Variable.count:  <span class="comment"># Every variable has been assigned -&gt; solution</span></span><br><span class="line">        print_result(variables, <span class="keyword">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Chooses a unassigned variable using MRV</span></span><br><span class="line">    variable_idx = <span class="number">0</span>  <span class="comment"># the index of the variable with minimum remaining value in domain</span></span><br><span class="line">    min_remained = Domain.size + <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(Variable.count):</span><br><span class="line">        var_itr = variables[i]</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> var_itr.assigned <span class="keyword">and</span> min_remained &gt; var_itr.domain.remained:</span><br><span class="line">            min_remained = var_itr.domain.remained</span><br><span class="line">            variable_idx = i</span><br><span class="line">    variable = variables[variable_idx]  <span class="comment"># The variable to be assigned</span></span><br><span class="line">    val_list = variable.domain.get_values()</span><br><span class="line">    <span class="keyword">if</span> min_remained == <span class="number">1</span>:</span><br><span class="line">        val = val_list[<span class="number">0</span>]</span><br><span class="line">        variable.assign(val)</span><br><span class="line">        <span class="keyword">if</span> variable.belong_uefa:  <span class="comment"># Deals with UEFA situations</span></span><br><span class="line">            group_uefa_cnt[val] += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> group_uefa_cnt[val] == <span class="number">2</span>:</span><br><span class="line">                conflict = <span class="keyword">False</span></span><br><span class="line">                <span class="keyword">for</span> var_itr <span class="keyword">in</span> variables:</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> var_itr.assigned <span class="keyword">and</span> var_itr.belong_uefa:</span><br><span class="line">                        var_itr.domain.reduce(val, assigned)</span><br><span class="line">                        <span class="keyword">if</span> var_itr.domain.remained == <span class="number">0</span>:</span><br><span class="line">                            conflict = <span class="keyword">True</span></span><br><span class="line">                            <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">if</span> conflict:</span><br><span class="line">                    group_uefa_cnt[val] -= <span class="number">1</span></span><br><span class="line">                    variable.assigned = <span class="keyword">False</span></span><br><span class="line">                    <span class="keyword">if</span> variable.domain.last_change != <span class="number">-1</span>:  <span class="comment"># If the most recent change is not initialization</span></span><br><span class="line">                        <span class="keyword">return</span> variable.domain.last_change</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">return</span> assigned - <span class="number">1</span></span><br><span class="line">        tmp = mac(variables, assigned + <span class="number">1</span>, group_uefa_cnt)</span><br><span class="line">        <span class="keyword">if</span> variable.belong_uefa:</span><br><span class="line">            group_uefa_cnt[val] -= <span class="number">1</span></span><br><span class="line">        variable.assigned = <span class="keyword">False</span></span><br><span class="line">        <span class="keyword">if</span> tmp &lt; assigned:</span><br><span class="line">            <span class="keyword">return</span> tmp</span><br><span class="line">        <span class="keyword">if</span> variable.domain.last_change != <span class="number">-1</span>:  <span class="comment"># If the most recent change is not initialization</span></span><br><span class="line">            <span class="keyword">return</span> variable.domain.last_change</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> assigned - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Backups domain if variable has more than 1 remaining values</span></span><br><span class="line">    backup_val = [var_itr.domain.get_values(<span class="keyword">True</span>) <span class="keyword">for</span> var_itr <span class="keyword">in</span> variables]</span><br><span class="line">    backup_remained = [var_itr.domain.remained <span class="keyword">for</span> var_itr <span class="keyword">in</span> variables]</span><br><span class="line">    constraining_cnt = [<span class="number">0</span>] * min_remained</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(min_remained):</span><br><span class="line">        <span class="comment"># print assigned, variable_idx, min_remained, val_list, i</span></span><br><span class="line">        tmp = <span class="number">1</span> &lt;&lt; val_list[i]</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> variable.constraint:</span><br><span class="line">            <span class="keyword">if</span> tmp &amp; variables[j].domain.get_values(<span class="keyword">True</span>) &gt; <span class="number">0</span>:</span><br><span class="line">                constraining_cnt[i] += <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(min_remained):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> xrange(i):</span><br><span class="line">            <span class="keyword">if</span> constraining_cnt[i] &lt; constraining_cnt[j]:</span><br><span class="line">                val_list[i], val_list[j] = val_list[j], val_list[i]</span><br><span class="line">                constraining_cnt[i], constraining_cnt[j] = constraining_cnt[j], constraining_cnt[i]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Attempts to assign each valid variable</span></span><br><span class="line">    <span class="keyword">for</span> val <span class="keyword">in</span> val_list:</span><br><span class="line">        variable.assign(val)</span><br><span class="line">        <span class="keyword">if</span> variable.belong_uefa:  <span class="comment"># Deals with UEFA situations</span></span><br><span class="line">            group_uefa_cnt[val] += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> group_uefa_cnt[val] == <span class="number">2</span>:</span><br><span class="line">                conflict = <span class="keyword">False</span></span><br><span class="line">                <span class="keyword">for</span> var_itr <span class="keyword">in</span> variables:</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> var_itr.assigned <span class="keyword">and</span> var_itr.belong_uefa:</span><br><span class="line">                        var_itr.domain.reduce(val, assigned)</span><br><span class="line">                        <span class="keyword">if</span> var_itr.domain.remained == <span class="number">0</span>:</span><br><span class="line">                            conflict = <span class="keyword">True</span></span><br><span class="line">                            <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">if</span> conflict:</span><br><span class="line">                    group_uefa_cnt[val] -= <span class="number">1</span></span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> ac3(variables, generate_constraint_queue(variables, variable_idx)):</span><br><span class="line">            tmp = mac(variables, assigned+<span class="number">1</span>, group_uefa_cnt)</span><br><span class="line">            <span class="keyword">if</span> tmp &lt; assigned:</span><br><span class="line">                <span class="keyword">if</span> variable.belong_uefa:</span><br><span class="line">                    group_uefa_cnt[val] -= <span class="number">1</span></span><br><span class="line">                variable.assigned = <span class="keyword">False</span></span><br><span class="line">                <span class="keyword">return</span> tmp</span><br><span class="line">        <span class="keyword">if</span> variable.belong_uefa:</span><br><span class="line">            group_uefa_cnt[val] -= <span class="number">1</span></span><br><span class="line">        <span class="comment"># Retrieves from backups if more than one remaining value</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(Variable.count):</span><br><span class="line">            variables[i].domain.retrieve(backup_val[i], backup_remained[i])</span><br><span class="line">    variable.assigned = <span class="keyword">False</span>  <span class="comment"># Cancels assignment</span></span><br><span class="line">    <span class="keyword">if</span> variable.domain.last_change != <span class="number">-1</span>:  <span class="comment"># If the most recent change is not initialization</span></span><br><span class="line">        <span class="keyword">return</span> variable.domain.last_change</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> assigned - <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'input.txt'</span>) <span class="keyword">as</span> input_file:  <span class="comment"># Gets input and init all info needed for solving this problem</span></span><br><span class="line">        Domain.init(int(input_file.readline()))</span><br><span class="line">        pot_count = int(input_file.readline())</span><br><span class="line">        variables = []</span><br><span class="line">        pot_countries = [input_file.readline().replace(<span class="string">'\n'</span>, <span class="string">''</span>).replace(<span class="string">'\r'</span>, <span class="string">''</span>).split(<span class="string">','</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(pot_count)]</span><br><span class="line">        <span class="keyword">for</span> pot_itr <span class="keyword">in</span> range(pot_count):</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> pot_countries[pot_itr]:</span><br><span class="line">                variables.append(Variable(i))</span><br><span class="line">        constraint_table = [[<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(Variable.count)] <span class="keyword">for</span> j <span class="keyword">in</span> range(Variable.count)]</span><br><span class="line">        cons1_table = [[<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(Variable.count)] <span class="keyword">for</span> j <span class="keyword">in</span> range(Variable.count)]</span><br><span class="line">        tmp_cnt = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> pot_itr <span class="keyword">in</span> range(pot_count):</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(len(pot_countries[pot_itr])):</span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> range(len(pot_countries[pot_itr])):</span><br><span class="line">                    <span class="keyword">if</span> i != j:</span><br><span class="line">                        constraint_table[i+tmp_cnt][j+tmp_cnt] = <span class="number">1</span></span><br><span class="line">                        cons1_table[i+tmp_cnt][j+tmp_cnt] = <span class="number">1</span></span><br><span class="line">            tmp_cnt += len(pot_countries[pot_itr])</span><br><span class="line">        <span class="keyword">for</span> con_itr <span class="keyword">in</span> range(CONFEDERATION_COUNT):</span><br><span class="line">            tmp_str = input_file.readline().replace(<span class="string">'\n'</span>, <span class="string">''</span>).replace(<span class="string">'\r'</span>, <span class="string">''</span>)</span><br><span class="line">            confederation_name = tmp_str.split(<span class="string">':'</span>)[<span class="number">0</span>]</span><br><span class="line">            country_name = tmp_str.split(<span class="string">':'</span>)[<span class="number">1</span>].split(<span class="string">','</span>)</span><br><span class="line">            <span class="comment"># Checks if obviously no solution</span></span><br><span class="line">            <span class="keyword">if</span> confederation_name == <span class="string">'UEFA'</span>:</span><br><span class="line">                <span class="keyword">if</span> len(country_name) &gt; <span class="number">2</span> * Domain.size:</span><br><span class="line">                    print_result()</span><br><span class="line">            <span class="keyword">elif</span> len(country_name) &gt; Domain.size:</span><br><span class="line">                print_result()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> country_name[<span class="number">0</span>] == <span class="string">'None'</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(len(country_name)):</span><br><span class="line">                <span class="keyword">if</span> confederation_name == <span class="string">'UEFA'</span>:</span><br><span class="line">                    variables[Variable.dict[country_name[i]]].belong_uefa = <span class="keyword">True</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">for</span> j <span class="keyword">in</span> range(len(country_name)):</span><br><span class="line">                        <span class="keyword">if</span> i != j:</span><br><span class="line">                            constraint_table[Variable.dict[country_name[i]]][Variable.dict[country_name[j]]] = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(Variable.count):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(Variable.count):</span><br><span class="line">                <span class="keyword">if</span> constraint_table[i][j] == <span class="number">1</span>:</span><br><span class="line">                    variables[i].constraint.append(j)</span><br><span class="line">    <span class="comment"># Chooses a pot with most country</span></span><br><span class="line">    <span class="comment"># Tie breaks by choosing a pot with most constraints except constraints created by the same pot</span></span><br><span class="line">    <span class="comment"># Inits by assigning value to each variable in this pot</span></span><br><span class="line">    max_pot_cnt = <span class="number">0</span></span><br><span class="line">    sum_cons = <span class="number">0</span></span><br><span class="line">    tmp_cnt = <span class="number">0</span></span><br><span class="line">    tmp_rec = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(pot_count):</span><br><span class="line">        <span class="keyword">if</span> len(pot_countries[i]) &gt; max_pot_cnt:</span><br><span class="line">            max_pot_cnt = len(pot_countries[i])</span><br><span class="line">            <span class="keyword">if</span> max_pot_cnt &gt; Domain.size:  <span class="comment"># Obviously no solution</span></span><br><span class="line">                print_result()</span><br><span class="line">            sum_cons = <span class="number">0</span></span><br><span class="line">            tmp_rec = tmp_cnt</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(max_pot_cnt):</span><br><span class="line">                sum_cons += sum(constraint_table[tmp_cnt+j]) - sum(cons1_table[tmp_cnt+j])</span><br><span class="line">        <span class="keyword">elif</span> len(pot_countries[i]) == max_pot_cnt:</span><br><span class="line">            tmp_sum = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(max_pot_cnt):</span><br><span class="line">                tmp_sum += sum(constraint_table[tmp_cnt+j]) - sum(cons1_table[tmp_cnt+j])</span><br><span class="line">            <span class="keyword">if</span> tmp_sum &gt; sum_cons:</span><br><span class="line">                sum_cons = tmp_sum</span><br><span class="line">                tmp_rec = tmp_cnt</span><br><span class="line">        tmp_cnt += len(pot_countries[i])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Inits the info about how many UEFA countries in a group</span></span><br><span class="line">    group_uefa_cnt = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(Domain.size)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(max_pot_cnt):</span><br><span class="line">        variables[tmp_rec+i].assign(i)</span><br><span class="line">        <span class="keyword">if</span> variables[tmp_rec+i].belong_uefa:</span><br><span class="line">            group_uefa_cnt[i] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> ac3(variables, generate_constraint_queue(variables)):</span><br><span class="line">        print_result()</span><br><span class="line">    mac(variables, max_pot_cnt, group_uefa_cnt)</span><br><span class="line">    print_result()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/04/a-python-code-shippet/" data-id="cjflnn8bc000fexpqsgmb0a0e" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Lab8" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/13/Lab8/" class="article-date">
  <time datetime="2016-06-13T08:26:31.000Z" itemprop="datePublished">2016-06-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/13/Lab8/">Lab8 LED</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id=""><a href="#" class="headerlink" title=""></a></h2><p><img src="http://scn3.github.io/image/lab8/figure1.png" alt=""></p>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h4 id=""><a href="#" class="headerlink" title=""></a></h4><pre><code>- Linux
- 5V/1A
- microUSB
- 
- MAX72198*8LED
- 
- PC
- 
</code></pre><h4 id=""><a href="#" class="headerlink" title=""></a></h4><pre><code>- 
- Fritzing
</code></pre><h2 id=""><a href="#" class="headerlink" title=""></a></h2><p><img src="http://scn3.github.io/image/lab7/figure2.png" alt=""></p>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h4 id="1-"><a href="#1-" class="headerlink" title="1. "></a>1. </h4><h4 id="2-"><a href="#2-" class="headerlink" title="2. "></a>2. </h4><h4 id="3-LinuxLED500ms"><a href="#3-LinuxLED500ms" class="headerlink" title="3. LinuxLED500ms"></a>3. LinuxLED500ms</h4><pre><code>1) sshRaspberry pi 2
2) insmod
3) CLED
</code></pre><h4 id="4-LinuxTCPLED"><a href="#4-LinuxTCPLED" class="headerlink" title="4. LinuxTCPLED"></a>4. LinuxTCPLED</h4><h4 id="5-telnetlinux"><a href="#5-telnetlinux" class="headerlink" title="5. telnetlinux"></a>5. telnetlinux</h4><pre><code>1) telnetRaspberry pi0123
2) 
3) 
</code></pre><p><img src="http://scn3.github.io/image/lab7/figure3.png" alt=""></p>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h4 id="1-LED"><a href="#1-LED" class="headerlink" title="1. LED"></a>1. LED</h4><pre><code class="C"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span>
<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span>
<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span>
<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span>
<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span>

<span class="keyword">int</span> Matrix;

<span class="meta">#<span class="meta-keyword">define</span> ALLCHAR <span class="string">"0123456789abcdefghijklmnopqrstuvwxyz"</span> <span class="comment">// </span></span>

<span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>{
    Matrix = open(<span class="string">"/dev/matrix"</span>, O_WRONLY);
    <span class="keyword">if</span> (Matrix &lt; <span class="number">0</span>){  <span class="comment">// </span>
        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Cound not open matrix device"</span>);
        <span class="built_in">exit</span>(<span class="number">1</span>);
    }
    write(Matrix, ALLCHAR, <span class="built_in">strlen</span>(ALLCHAR));  <span class="comment">// </span>
    <span class="keyword">return</span> <span class="number">0</span>;
}
</code></pre>
<h4 id="2-TCP"><a href="#2-TCP" class="headerlink" title="2. TCP"></a>2. TCP</h4><pre><code class="C"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span>
<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span>
<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span>
<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span>
<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span>
<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span>
<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span>
<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;netinet/in.h&gt;</span></span>
<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;arpa/inet.h&gt;</span></span>
<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span>====</span>

<span class="keyword">int</span> Matrix;
<span class="keyword">int</span> server;

<span class="meta">#<span class="meta-keyword">define</span> PORT 8080</span>
<span class="meta">#<span class="meta-keyword">define</span> ADDR <span class="string">"0.0.0.0"</span></span>
<span class="meta">#<span class="meta-keyword">define</span> QUEUE 20</span>

<span class="meta">#<span class="meta-keyword">define</span> BUFF_SIZE 2048</span>

<span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>{
    <span class="comment">// matrix</span>
    Matrix = open(<span class="string">"/dev/matrix"</span>, O_WRONLY);
    <span class="keyword">if</span> (Matrix &lt; <span class="number">0</span>){
        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Cound not open matrix device\n"</span>);
        <span class="built_in">exit</span>(<span class="number">1</span>);
    }
    <span class="comment">// </span>
    <span class="keyword">int</span> server = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);

    <span class="keyword">struct</span> sockaddr_in serverAddr;
    serverAddr.sin_family = AF_INET;
    serverAddr.sin_addr.s_addr = inet_addr(ADDR);
    serverAddr.sin_port = htons(PORT);

    <span class="comment">// ip</span>
    <span class="keyword">if</span> (bind(server, (<span class="keyword">struct</span> sockaddr*)&amp;serverAddr, <span class="keyword">sizeof</span>(serverAddr)) == <span class="number">-1</span>){
        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Count not bind %s:%d\n"</span>, ADDR, PORT);
        <span class="built_in">exit</span>(<span class="number">1</span>);
    }

    <span class="keyword">if</span> (listen(server, QUEUE) == <span class="number">-1</span>){
        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Listen error\n"</span>);
        <span class="built_in">exit</span>(<span class="number">1</span>);
    }

    <span class="built_in">printf</span>(<span class="string">"Server running at %s:%d\n"</span>, ADDR, PORT);

    <span class="keyword">while</span> (<span class="number">1</span>){
        <span class="keyword">struct</span> sockaddr_in clientAddr;
        <span class="keyword">socklen_t</span> length = <span class="keyword">sizeof</span>(clientAddr);

        <span class="comment">// </span>
        <span class="keyword">int</span> conn = accept(server, (<span class="keyword">struct</span> sockaddr*)&amp;clientAddr, &amp;length);
        <span class="keyword">if</span> (conn &lt; <span class="number">0</span>){
            <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Connect error"</span>);
            <span class="built_in">exit</span>(<span class="number">1</span>);
        }

        <span class="built_in">printf</span>(<span class="string">"A new connection from %s:%d\n"</span>, inet_ntoa(clientAddr.sin_addr), clientAddr.sin_port);

        <span class="comment">// </span>
        <span class="keyword">while</span> (<span class="number">1</span>){
            <span class="keyword">char</span> receiveBuf[BUFF_SIZE];
            <span class="keyword">int</span> count;
            <span class="built_in">memset</span>(receiveBuf, <span class="number">0</span>, <span class="keyword">sizeof</span>(receiveBuf));

            <span class="comment">// </span>
            count = recv(conn, receiveBuf, <span class="keyword">sizeof</span>(receiveBuf), <span class="number">0</span>);

            <span class="comment">// </span>
            <span class="keyword">if</span> (count == <span class="number">0</span>){
                close(conn);
                <span class="keyword">break</span>;
            }

            <span class="comment">// matrix</span>
            write(Matrix, receiveBuf, count);
        }
    }
    close(server);
    <span class="keyword">return</span> <span class="number">0</span>;
}
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/06/13/Lab8/" data-id="cjflnn8b3000bexpqxcdroeyj" class="article-share-link">Partager</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Embeded-System/">Embeded System</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Lab7" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/13/Lab7/" class="article-date">
  <time datetime="2016-06-13T08:09:33.000Z" itemprop="datePublished">2016-06-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/13/Lab7/">Lab7 </a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id=""><a href="#" class="headerlink" title=""></a></h2><p><img src="http://scn3.github.io/image/lab7/figure1.png" alt=""></p>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h4 id=""><a href="#" class="headerlink" title=""></a></h4><pre><code>- Linux
- 5V/1A
- microUSB
- 
- MAX72198*8LED
- 
- PC
- 
</code></pre><h4 id=""><a href="#" class="headerlink" title=""></a></h4><pre><code>- 
- Fritzing
</code></pre><h2 id=""><a href="#" class="headerlink" title=""></a></h2><p><img src="http://scn3.github.io/image/lab7/figure2.png" alt=""></p>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h4 id="1-"><a href="#1-" class="headerlink" title="1. "></a>1. </h4><h4 id="2-"><a href="#2-" class="headerlink" title="2. "></a>2. </h4><h4 id="3-C-C-Arduido-ishGPIO"><a href="#3-C-C-Arduido-ishGPIO" class="headerlink" title="3. C/C++Arduido-ishGPIO"></a>3. C/C++Arduido-ishGPIO</h4><pre><code>1) sshRaspberry
2) C/C++GPIO
3) C/C++
</code></pre><p><img src="http://scn3.github.io/image/lab7/figure3.png" alt=""></p>
<h4 id="4-GPIOwrite-"><a href="#4-GPIOwrite-" class="headerlink" title="4. GPIOwrite() "></a>4. GPIOwrite() </h4><pre><code>1) 
2) 
3) 
</code></pre><p><img src="http://scn3.github.io/image/lab7/figure4.png" alt=""><br><img src="http://scn3.github.io/image/lab7/figure5.png" alt=""><br><img src="http://scn3.github.io/image/lab7/figure6.png" alt=""><br><img src="http://scn3.github.io/image/lab7/figure7.png" alt=""><br><img src="http://scn3.github.io/image/lab7/figure8.png" alt=""><br><img src="http://scn3.github.io/image/lab7/figure9.png" alt=""><br><img src="http://scn3.github.io/image/lab7/figure10.png" alt=""><br><img src="http://scn3.github.io/image/lab7/figure11.png" alt=""><br><img src="http://scn3.github.io/image/lab7/figure12.png" alt=""><br><img src="http://scn3.github.io/image/lab7/figure13.png" alt=""></p>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h4 id="1-GPIO"><a href="#1-GPIO" class="headerlink" title="1. GPIO"></a>1. GPIO</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DIN 4  <span class="comment">// DINGPIO</span></span><span class="meta">#<span class="meta-keyword">define</span> CS 3  <span class="comment">// CSGPIO</span></span><span class="meta">#<span class="meta-keyword">define</span> CLK 2  <span class="comment">// CLKGPIO</span></span>GPIO_Pin din, cs, clk;<span class="function"><span class="keyword">int</span> <span class="title">write_byte</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> b)</span></span>&#123;    <span class="keyword">unsigned</span> <span class="keyword">char</span> i, tmp;    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">8</span>; i++)&#123;        tmp = (b &amp; <span class="number">0x80</span>) &gt; <span class="number">0</span>;        b &lt;&lt;= <span class="number">1</span>;        GPIO_Pin_Write(&amp;din, tmp);        GPIO_Pin_Write(&amp;clk, <span class="number">1</span>);        GPIO_Pin_Write(&amp;clk, <span class="number">0</span>);    &#125;&#125;<span class="function"><span class="keyword">int</span> <span class="title">write_word</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> addr, <span class="keyword">unsigned</span> <span class="keyword">char</span> num)</span></span>&#123;    GPIO_Pin_Write(&amp;cs, <span class="number">1</span>);    GPIO_Pin_Write(&amp;cs, <span class="number">0</span>);    GPIO_Pin_Write(&amp;clk, <span class="number">0</span>);    write_byte(addr);    write_byte(num);    GPIO_Pin_Write(&amp;cs, <span class="number">1</span>);&#125;<span class="function"><span class="keyword">int</span> <span class="title">Matrix_init</span><span class="params">()</span></span>&#123;  <span class="comment">// </span>    write_word(<span class="number">0x09</span>, <span class="number">0x00</span>);  <span class="comment">// </span>    write_word(<span class="number">0x0a</span>, <span class="number">0x03</span>); <span class="comment">// </span>    write_word(<span class="number">0x0b</span>, <span class="number">0x07</span>);  <span class="comment">// </span>    write_word(<span class="number">0x0c</span>, <span class="number">0x01</span>);  <span class="comment">// </span>&#125;<span class="function"><span class="keyword">int</span> <span class="title">Matrix_render</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span>* tmp)</span></span>&#123; <span class="comment">// </span>    <span class="keyword">int</span> i;    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">8</span>; i++)&#123;        <span class="built_in">printf</span>(<span class="string">"%d %d\n"</span>, i, tmp[i]);        write_word(i+<span class="number">1</span>, tmp[i]);    &#125;&#125;<span class="function"><span class="keyword">int</span> <span class="title">Matrix_clear</span><span class="params">()</span></span>&#123; <span class="comment">// </span>    <span class="keyword">unsigned</span> <span class="keyword">char</span> SCN[]=&#123;        <span class="number">0xFF</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0xFF</span>    &#125;;    Matrix_render(SCN);&#125;<span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;    GPIO_Pin_export(&amp;din, DIN, GPIO_DIRECTION_OUT);    GPIO_Pin_export(&amp;cs, CS, GPIO_DIRECTION_OUT);    GPIO_Pin_export(&amp;clk, CLK, GPIO_DIRECTION_OUT);    Matrix_init();    Matrix_clear();    <span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-"><a href="#2-" class="headerlink" title="2. "></a>2. </h4><pre><code class="C"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/init.h&gt;</span></span>
<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/kernel.h&gt;</span></span>
<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/module.h&gt;</span></span>
<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/moduleparam.h&gt;</span></span>
<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/fs.h&gt;</span></span>
<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/miscdevice.h&gt;</span></span>
<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/string.h&gt;</span></span>
<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/delay.h&gt;</span></span>
<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/gpio.h&gt;</span></span>
<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/workqueue.h&gt;</span></span>

MODULE_LICENSE(<span class="string">"GPL"</span>);

<span class="meta">#<span class="meta-keyword">define</span> DIN 4</span>
<span class="meta">#<span class="meta-keyword">define</span> CS 3</span>
<span class="meta">#<span class="meta-keyword">define</span> CLK 2</span>

<span class="function"><span class="keyword">void</span> <span class="title">write_byte</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> b)</span></span>{
    <span class="keyword">unsigned</span> <span class="keyword">char</span> i, tmp;
    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">8</span>; i++){
        tmp = (b &amp; <span class="number">0x80</span>) &gt; <span class="number">0</span>;
        b &lt;&lt;= <span class="number">1</span>;
        gpio_set_value(DIN, tmp);
        gpio_set_value(CLK, <span class="number">1</span>);
        gpio_set_value(CLK, <span class="number">0</span>);
    }
}

<span class="function"><span class="keyword">void</span> <span class="title">write_word</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> addr, <span class="keyword">unsigned</span> <span class="keyword">char</span> num)</span></span>{
    gpio_set_value(CLK, <span class="number">0</span>);
    gpio_set_value(CS, <span class="number">1</span>);
    gpio_set_value(CS, <span class="number">0</span>);
    write_byte(addr);
    write_byte(num);
    gpio_set_value(CS, <span class="number">1</span>);
}

<span class="function"><span class="keyword">void</span> <span class="title">Matrix_render</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span>* tmp)</span></span>{ <span class="comment">// </span>
    <span class="keyword">int</span> i;
    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">8</span>; i++){
        write_word(i+<span class="number">1</span>, tmp[i]);
    }
}

<span class="keyword">unsigned</span> <span class="keyword">char</span> digits[][<span class="number">8</span>]={
    {<span class="number">0x1c</span>, <span class="number">0x22</span>, <span class="number">0x22</span>, <span class="number">0x22</span>, <span class="number">0x22</span>, <span class="number">0x22</span>, <span class="number">0x22</span>, <span class="number">0x1c</span>}, <span class="comment">// 0</span>
    {<span class="number">0x08</span>, <span class="number">0x18</span>, <span class="number">0x08</span>, <span class="number">0x08</span>, <span class="number">0x08</span>, <span class="number">0x08</span>, <span class="number">0x08</span>, <span class="number">0x1c</span>}, <span class="comment">// 1</span>
    {<span class="number">0x1c</span>, <span class="number">0x22</span>, <span class="number">0x22</span>, <span class="number">0x04</span>, <span class="number">0x08</span>, <span class="number">0x10</span>, <span class="number">0x20</span>, <span class="number">0x3e</span>}, <span class="comment">// 2</span>
    {<span class="number">0x1c</span>, <span class="number">0x22</span>, <span class="number">0x02</span>, <span class="number">0x0c</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x22</span>, <span class="number">0x1c</span>}, <span class="comment">// 3</span>
    {<span class="number">0x04</span>, <span class="number">0x0c</span>, <span class="number">0x14</span>, <span class="number">0x14</span>, <span class="number">0x24</span>, <span class="number">0x1e</span>, <span class="number">0x04</span>, <span class="number">0x04</span>}, <span class="comment">// 4</span>
    {<span class="number">0x3e</span>, <span class="number">0x20</span>, <span class="number">0x20</span>, <span class="number">0x3c</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x22</span>, <span class="number">0x1c</span>}, <span class="comment">// 5</span>
    {<span class="number">0x1c</span>, <span class="number">0x22</span>, <span class="number">0x20</span>, <span class="number">0x3c</span>, <span class="number">0x22</span>, <span class="number">0x22</span>, <span class="number">0x22</span>, <span class="number">0x1c</span>}, <span class="comment">// 6</span>
    {<span class="number">0x3e</span>, <span class="number">0x24</span>, <span class="number">0x04</span>, <span class="number">0x08</span>, <span class="number">0x08</span>, <span class="number">0x08</span>, <span class="number">0x08</span>, <span class="number">0x08</span>}, <span class="comment">// 7</span>
    {<span class="number">0x1c</span>, <span class="number">0x22</span>, <span class="number">0x22</span>, <span class="number">0x1c</span>, <span class="number">0x22</span>, <span class="number">0x22</span>, <span class="number">0x22</span>, <span class="number">0x1c</span>}, <span class="comment">// 8</span>
    {<span class="number">0x1c</span>, <span class="number">0x22</span>, <span class="number">0x22</span>, <span class="number">0x22</span>, <span class="number">0x1e</span>, <span class="number">0x02</span>, <span class="number">0x22</span>, <span class="number">0x1c</span>}, <span class="comment">// 9</span>
};

<span class="keyword">unsigned</span> <span class="keyword">char</span> SCN[]={
    <span class="number">0x99</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x99</span>, <span class="number">0x99</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x99</span>
};

<span class="function"><span class="keyword">void</span> <span class="title">Matrix_clear</span><span class="params">(<span class="keyword">void</span>)</span></span>{ <span class="comment">// </span>
    Matrix_render(SCN);
}

<span class="function"><span class="keyword">void</span> <span class="title">Matrix_init</span><span class="params">(<span class="keyword">void</span>)</span></span>{ <span class="comment">// </span>
    write_word(<span class="number">0x09</span>, <span class="number">0x00</span>); <span class="comment">// </span>
    write_word(<span class="number">0x0a</span>, <span class="number">0x03</span>); <span class="comment">// </span>
    write_word(<span class="number">0x0b</span>, <span class="number">0x07</span>); <span class="comment">// </span>
    write_word(<span class="number">0x0c</span>, <span class="number">0x01</span>); <span class="comment">// </span>

    Matrix_clear();
}

<span class="meta">#<span class="meta-keyword">define</span> BUFFERSIZE 128</span>
<span class="meta">#<span class="meta-keyword">define</span> DELAYTIME 1</span>
<span class="keyword">unsigned</span> <span class="keyword">char</span> disp[BUFFERSIZE];
<span class="keyword">int</span> head = <span class="number">0</span>, tail = <span class="number">0</span>;
<span class="keyword">static</span> <span class="keyword">struct</span> timer_list timer;

<span class="function"><span class="keyword">void</span> <span class="title">Matrix_next_display</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">long</span>)</span></span>;

<span class="function"><span class="keyword">void</span> <span class="title">ptr_inc</span><span class="params">(<span class="keyword">int</span> *ptr)</span></span>{
    *ptr = (*ptr + <span class="number">1</span>) % BUFFERSIZE;
}

<span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">timer_register</span><span class="params">(<span class="keyword">struct</span> timer_list* ptimer)</span></span>{
    init_timer(ptimer);
    ptimer-&gt;data = DELAYTIME;
    ptimer-&gt;expires = jiffies + (DELAYTIME * HZ);
    ptimer-&gt;function = Matrix_next_display;
    add_timer(ptimer);
}

<span class="function"><span class="keyword">void</span> <span class="title">disp_start</span><span class="params">(<span class="keyword">void</span>)</span></span>{
    timer_register(&amp;timer);
}

<span class="function"><span class="keyword">void</span> <span class="title">Matrix_next_display</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">long</span> data)</span></span>{
    <span class="keyword">if</span> (head != tail){
        <span class="keyword">unsigned</span> <span class="keyword">char</span> *ptr = SCN;
        <span class="keyword">unsigned</span> <span class="keyword">char</span> c = disp[head];
        <span class="keyword">if</span> (<span class="string">'0'</span> &lt;= c &amp;&amp; c &lt;= <span class="string">'9'</span>){
            ptr = digits[c - <span class="string">'0'</span>];
        }
        Matrix_render(ptr);
        ptr_inc(&amp;head);
        disp_start();
    }<span class="keyword">else</span>{
        Matrix_clear();
    }
}

<span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">matrix_write</span><span class="params">(<span class="keyword">struct</span> file *file, <span class="keyword">const</span> <span class="keyword">char</span> __user *buffer,
        size_t count, loff_t *ppos)</span></span>{
    <span class="keyword">int</span> i;
    <span class="keyword">if</span> (head == tail &amp;&amp; count &gt; <span class="number">0</span>){
        disp_start();
    }
    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;count; i++){
        ptr_inc(&amp;tail);
        <span class="keyword">if</span> (tail == head)
            ptr_inc(&amp;head);
        disp[tail] = buffer[i];
    }
    <span class="keyword">return</span> count;
}

<span class="keyword">static</span> <span class="keyword">struct</span> file_operations matrix_fops = {
    .owner = THIS_MODULE,
    .write = matrix_write,
    .llseek = noop_llseek
};

<span class="keyword">static</span> <span class="keyword">struct</span> miscdevice matrix_misc_device = {
    .minor = MISC_DYNAMIC_MINOR,
    .name = <span class="string">"matrix"</span>,
    .fops = &amp;matrix_fops
};

<span class="keyword">static</span> <span class="keyword">int</span> __<span class="function">init <span class="title">matrix_init</span><span class="params">(<span class="keyword">void</span>)</span></span>{
    <span class="keyword">if</span> (!gpio_is_valid(DIN) || !gpio_is_valid(CLK) || !gpio_is_valid(CS)){
        printk(KERN_INFO <span class="string">"GPIO_TEST: invalid GPIO\n"</span>);
        <span class="keyword">return</span> -ENODEV;
    }
    misc_register(&amp;matrix_misc_device);
    gpio_request(DIN, <span class="string">"sysfs"</span>);
    gpio_direction_output(DIN, <span class="number">0</span>);
    gpio_request(CS, <span class="string">"sysfs"</span>);
    gpio_direction_output(CS, <span class="number">1</span>);
    gpio_request(CLK, <span class="string">"sysfs"</span>);
    gpio_direction_output(CLK, <span class="number">0</span>);
    Matrix_init();
    printk(KERN_INFO<span class="string">"matrix device has been registed.\n"</span>);
    <span class="keyword">return</span> <span class="number">0</span>;
}

<span class="keyword">static</span> <span class="keyword">void</span> __<span class="function"><span class="built_in">exit</span> <span class="title">matrix_exit</span><span class="params">(<span class="keyword">void</span>)</span></span>{
    misc_deregister(&amp;matrix_misc_device);
    printk(KERN_INFO<span class="string">"matrix device has been unregisted.\n"</span>);
    del_timer(&amp;timer);
}

module_init(matrix_init);
module_exit(matrix_exit);
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/06/13/Lab7/" data-id="cjflnn8b20008expqr23x7b2i" class="article-share-link">Partager</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Embeded-System/">Embeded System</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Lab5" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/13/Lab5/" class="article-date">
  <time datetime="2016-06-13T07:44:44.000Z" itemprop="datePublished">2016-06-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/13/Lab5/">Lab5 uC/OS </a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id=""><a href="#" class="headerlink" title=""></a></h2><p><img src="http://scn3.github.io/image/lab5/figure1.png" alt=""></p>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h4 id=""><a href="#" class="headerlink" title=""></a></h4><pre><code>- STM32F103
- USB
- 
- 7
- 360 1/8W2
- DHT-111
- 
</code></pre><h4 id=""><a href="#" class="headerlink" title=""></a></h4><pre><code>- 
- Fritzing
</code></pre><h2 id=""><a href="#" class="headerlink" title=""></a></h2><p><img src="http://scn3.github.io/image/lab5/figure2.png" alt=""></p>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h4 id="1-"><a href="#1-" class="headerlink" title="1."></a>1.</h4><h4 id="2-"><a href="#2-" class="headerlink" title="2."></a>2.</h4><h4 id="3-C-C-"><a href="#3-C-C-" class="headerlink" title="3.C/C++"></a>3.C/C++</h4><pre><code>1) uC/OSGPIO
2) DHT-11
3) 70000-9999
4) uC/OSDHT-11
</code></pre><h2 id=""><a href="#" class="headerlink" title=""></a></h2><h4 id="7"><a href="#7" class="headerlink" title="7"></a>7</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GPIO_Configuration</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    GPIO_InitTypeDef GPIO_InitStructure;</span><br><span class="line"></span><br><span class="line">    RCC_DeInit();</span><br><span class="line">    RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOC | RCC_APB2Periph_GPIOA, ENABLE);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    GPIO_InitStructure.GPIO_Pin = GPIO_Pin_13</span><br><span class="line">                                | GPIO_Pin_14;</span><br><span class="line">    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP;</span><br><span class="line">    GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;</span><br><span class="line">    GPIO_Init(GPIOC, &amp;GPIO_InitStructure);</span><br><span class="line"></span><br><span class="line">    GPIO_InitStructure.GPIO_Pin = GPIO_Pin_11</span><br><span class="line">                                | GPIO_Pin_12;</span><br><span class="line">    GPIO_Init(GPIOA, &amp;GPIO_InitStructure);</span><br><span class="line"></span><br><span class="line">    GPIO_InitStructure.GPIO_Pin = GPIO_Pin_0</span><br><span class="line">                                | GPIO_Pin_1</span><br><span class="line">                                | GPIO_Pin_2</span><br><span class="line">                                | GPIO_Pin_3</span><br><span class="line">                                | GPIO_Pin_4</span><br><span class="line">                                | GPIO_Pin_5</span><br><span class="line">                                | GPIO_Pin_6</span><br><span class="line">                                | GPIO_Pin_7;</span><br><span class="line">    GPIO_Init(GPIOA, &amp;GPIO_InitStructure);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Delay_ms</span><span class="params">(<span class="keyword">int</span> times)</span></span>&#123;</span><br><span class="line">    OSTimeDly(OS_TICKS_PER_SEC / <span class="number">1000</span> * times);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">digit_select</span><span class="params">(<span class="keyword">int</span> index)</span></span>&#123;</span><br><span class="line">    <span class="comment">// </span></span><br><span class="line">    BitAction v[<span class="number">4</span>];</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">4</span>; i++)&#123;</span><br><span class="line">        <span class="keyword">if</span> (index == i)&#123;</span><br><span class="line">            v[i] = Bit_SET;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            v[i] = Bit_RESET;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    GPIO_WriteBit(GPIOA, GPIO_Pin_11, v[<span class="number">0</span>]);</span><br><span class="line">    GPIO_WriteBit(GPIOA, GPIO_Pin_12, v[<span class="number">1</span>]);</span><br><span class="line">    GPIO_WriteBit(GPIOC, GPIO_Pin_13, v[<span class="number">2</span>]);</span><br><span class="line">    GPIO_WriteBit(GPIOC, GPIO_Pin_14, v[<span class="number">3</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">digit_show</span><span class="params">(<span class="keyword">int</span> dight, <span class="keyword">int</span> point)</span></span>&#123;</span><br><span class="line">    <span class="comment">// </span></span><br><span class="line">    <span class="keyword">int</span> segment, i, base;</span><br><span class="line">    BitAction v[<span class="number">8</span>];</span><br><span class="line">    <span class="keyword">switch</span> (dight)&#123;</span><br><span class="line">        <span class="keyword">case</span>    <span class="number">0</span>    :    segment = <span class="number">0xee</span>; <span class="keyword">break</span>; <span class="comment">// 0b11101110  0 -&gt; 7</span></span><br><span class="line">        <span class="keyword">case</span>    <span class="number">1</span>    :    segment = <span class="number">0x24</span>; <span class="keyword">break</span>; <span class="comment">// 0b00100100</span></span><br><span class="line">        <span class="keyword">case</span>    <span class="number">2</span>    :    segment = <span class="number">0xba</span>; <span class="keyword">break</span>; <span class="comment">// 0b10111010</span></span><br><span class="line">        <span class="keyword">case</span>    <span class="number">3</span>    :    segment = <span class="number">0xb6</span>; <span class="keyword">break</span>; <span class="comment">// 0b10110110</span></span><br><span class="line">        <span class="keyword">case</span>    <span class="number">4</span>    :    segment = <span class="number">0x74</span>; <span class="keyword">break</span>; <span class="comment">// 0b01110100</span></span><br><span class="line">        <span class="keyword">case</span>    <span class="number">5</span>    :    segment = <span class="number">0xd6</span>; <span class="keyword">break</span>; <span class="comment">// 0b11010110</span></span><br><span class="line">        <span class="keyword">case</span>    <span class="number">6</span>    :    segment = <span class="number">0xde</span>; <span class="keyword">break</span>; <span class="comment">// 0b11011110</span></span><br><span class="line">        <span class="keyword">case</span>    <span class="number">7</span>    :    segment = <span class="number">0xa4</span>; <span class="keyword">break</span>; <span class="comment">// 0b10100100</span></span><br><span class="line">        <span class="keyword">case</span>    <span class="number">8</span>    :    segment = <span class="number">0xfe</span>; <span class="keyword">break</span>; <span class="comment">// 0b11111110</span></span><br><span class="line">        <span class="keyword">case</span>    <span class="number">9</span>    :    segment = <span class="number">0xf6</span>; <span class="keyword">break</span>; <span class="comment">// 0b11110110</span></span><br><span class="line">        <span class="keyword">default</span>        :    segment = <span class="number">0xda</span>; <span class="keyword">break</span>; <span class="comment">// 0b11011010 error state</span></span><br><span class="line">    &#125;</span><br><span class="line">    segment |= point != <span class="number">0</span>; <span class="comment">// </span></span><br><span class="line">    base = <span class="number">1</span> &lt;&lt; <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">8</span>; i++)&#123;</span><br><span class="line">        base &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// segment1</span></span><br><span class="line">        <span class="keyword">if</span> ((segment &amp; base )== <span class="number">0</span>)&#123;</span><br><span class="line">            v[i] = Bit_SET;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            v[i] = Bit_RESET;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    GPIO_WriteBit(GPIOA, GPIO_Pin_0, v[<span class="number">0</span>]);</span><br><span class="line">    GPIO_WriteBit(GPIOA, GPIO_Pin_1, v[<span class="number">1</span>]);</span><br><span class="line">    GPIO_WriteBit(GPIOA, GPIO_Pin_2, v[<span class="number">2</span>]);</span><br><span class="line">    GPIO_WriteBit(GPIOA, GPIO_Pin_3, v[<span class="number">3</span>]);</span><br><span class="line">    GPIO_WriteBit(GPIOA, GPIO_Pin_4, v[<span class="number">4</span>]);</span><br><span class="line">    GPIO_WriteBit(GPIOA, GPIO_Pin_5, v[<span class="number">5</span>]);</span><br><span class="line">    GPIO_WriteBit(GPIOA, GPIO_Pin_6, v[<span class="number">6</span>]);</span><br><span class="line">    GPIO_WriteBit(GPIOA, GPIO_Pin_7, v[<span class="number">7</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">led_show</span><span class="params">(<span class="keyword">int</span> digit)</span></span>&#123;</span><br><span class="line">    <span class="comment">// led_show</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> index = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">int</span> base = <span class="number">1000</span>;</span><br><span class="line">    index = (index + <span class="number">1</span>) % <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;index; i++)&#123;</span><br><span class="line">        base /= <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    digit = (digit / base) % <span class="number">10</span>;</span><br><span class="line">    digit_select(index);</span><br><span class="line">    digit_show(digit, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> ledValue = <span class="number">0</span>; <span class="comment">// task0task1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LED0_task</span><span class="params">(<span class="keyword">void</span>* pdata)</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)&#123;</span><br><span class="line">        ledValue++;</span><br><span class="line">        Delay_ms(<span class="number">200</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LED1_task</span><span class="params">(<span class="keyword">void</span>* pdata)</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        led_show(ledValue);</span><br><span class="line">        Delay_ms(<span class="number">7</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="DHT11"><a href="#DHT11" class="headerlink" title="DHT11"></a>DHT11</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_TICS 100000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DHT11_OK 0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DHT11_NO_CONN 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DHT11_CS_ERROR 2</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DHT11_PORT GPIOB</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DHT11_PIN GPIO_Pin_0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Delay_us</span><span class="params">(<span class="keyword">int</span> times)</span></span>&#123;</span><br><span class="line">    <span class="comment">// delay1.4us * @times</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;times; i++)&#123;</span><br><span class="line">        <span class="comment">// 1us</span></span><br><span class="line">        <span class="comment">/*</span><br><span class="line">        unsigned int j;</span><br><span class="line">        for (j=0; j&lt;0x3fff; j++)&#123;</span><br><span class="line">        &#125;</span><br><span class="line">        */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ErrorState</span><span class="params">(<span class="keyword">int</span> state)</span></span>&#123;</span><br><span class="line">    <span class="comment">// </span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)&#123;</span><br><span class="line">        led_show(state);</span><br><span class="line">        Delay_us(<span class="number">4000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DHT11_Set</span><span class="params">(<span class="keyword">int</span> state)</span></span>&#123;</span><br><span class="line">    <span class="comment">// DHT11 GPIO</span></span><br><span class="line">    BitAction s;</span><br><span class="line">    <span class="keyword">if</span> (state)&#123;</span><br><span class="line">        s = Bit_SET;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        s = Bit_RESET;</span><br><span class="line">    &#125;</span><br><span class="line">    GPIO_WriteBit(DHT11_PORT, DHT11_PIN, s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DHT11_Pin_OUT</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// DHT11 GPIO</span></span><br><span class="line">    GPIO_InitTypeDef GPIO_InitStructure;</span><br><span class="line"></span><br><span class="line">    GPIO_InitStructure.GPIO_Pin = DHT11_PIN;</span><br><span class="line">    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP;</span><br><span class="line">    GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;</span><br><span class="line">    GPIO_Init(DHT11_PORT, &amp;GPIO_InitStructure);</span><br><span class="line"></span><br><span class="line">    DHT11_Set(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DHT11_Pin_IN</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// DHT11_GPIO</span></span><br><span class="line">    GPIO_InitTypeDef GPIO_InitStructure;</span><br><span class="line"></span><br><span class="line">    GPIO_InitStructure.GPIO_Pin = DHT11_PIN;</span><br><span class="line">    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IN_FLOATING;</span><br><span class="line">    GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;</span><br><span class="line">    GPIO_Init(DHT11_PORT, &amp;GPIO_InitStructure);</span><br><span class="line"></span><br><span class="line">    DHT11_Set(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">uint8_t</span> DHT11_Check()&#123;</span><br><span class="line">    <span class="comment">// DHT11 GPIO</span></span><br><span class="line">    <span class="keyword">return</span> (DHT11_PORT-&gt;IDR &amp; DHT11_PIN)&gt; <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//return GPIO_ReadInputDataBit(DHT11_PORT, DHT11_PIN);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DHT11_Wait</span><span class="params">(<span class="keyword">int</span> state, <span class="keyword">int</span> place)</span></span>&#123;</span><br><span class="line">    <span class="comment">// GPIOstate</span></span><br><span class="line">    <span class="keyword">int</span> loopCnt = MAX_TICS;</span><br><span class="line">    <span class="keyword">while</span> (DHT11_Check() != state)&#123;</span><br><span class="line">        <span class="keyword">if</span> (loopCnt -- == <span class="number">0</span>)&#123;</span><br><span class="line">            ErrorState(<span class="number">1000</span> + state * <span class="number">1000</span> + place);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DHT11_Rst</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// stm32</span></span><br><span class="line">    DHT11_Pin_OUT();</span><br><span class="line">    DHT11_Set(<span class="number">0</span>);</span><br><span class="line">    Delay_us(<span class="number">25000</span>);</span><br><span class="line">    DHT11_Set(<span class="number">1</span>);</span><br><span class="line">    Delay_us(<span class="number">40</span>);</span><br><span class="line">    DHT11_Set(<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// DHT11</span></span><br><span class="line">    DHT11_Pin_IN();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> val = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">uint8_t</span> DHT11_Read_Byte()&#123;</span><br><span class="line">    <span class="comment">// Byte</span></span><br><span class="line">    <span class="keyword">int</span> i, cnt;</span><br><span class="line">    <span class="keyword">uint8_t</span> data = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">8</span>; i++)&#123;</span><br><span class="line">        cnt = <span class="number">0</span>;</span><br><span class="line">        data &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// </span></span><br><span class="line">        DHT11_Wait(<span class="number">1</span>, ++val);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// </span></span><br><span class="line">        <span class="keyword">while</span> (DHT11_Check() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            Delay_us(<span class="number">1</span>);</span><br><span class="line">            cnt++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// bit 1</span></span><br><span class="line">        data |= cnt &gt; <span class="number">5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">uint8_t</span> DHT11_Read_Data(<span class="keyword">uint8_t</span> *buf)&#123;</span><br><span class="line">    <span class="comment">// DHT11</span></span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> cpu_sr;</span><br><span class="line">    <span class="comment">// </span></span><br><span class="line">    OS_ENTER_CRITICAL();</span><br><span class="line">    val = <span class="number">10</span>;</span><br><span class="line">    <span class="comment">// </span></span><br><span class="line">    DHT11_Rst();</span><br><span class="line">    <span class="comment">// </span></span><br><span class="line">    <span class="keyword">if</span> (DHT11_Check() == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="comment">// </span></span><br><span class="line">        DHT11_Wait(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="comment">// </span></span><br><span class="line">        DHT11_Wait(<span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line">        <span class="comment">// 40bit</span></span><br><span class="line">        <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++)&#123;</span><br><span class="line">            buf[i] = DHT11_Read_Byte();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// GPIO</span></span><br><span class="line">        DHT11_Pin_OUT();</span><br><span class="line">        OS_EXIT_CRITICAL(); </span><br><span class="line"></span><br><span class="line">        <span class="comment">// </span></span><br><span class="line">        <span class="keyword">if</span> (buf[<span class="number">0</span>] + buf[<span class="number">1</span>] + buf[<span class="number">2</span>] + buf[<span class="number">3</span>] == buf[<span class="number">4</span>])&#123;</span><br><span class="line">            <span class="keyword">return</span> DHT11_OK;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> DHT11_CS_ERROR;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">// </span></span><br><span class="line">        OS_EXIT_CRITICAL(); </span><br><span class="line">        <span class="keyword">return</span> DHT11_NO_CONN;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">uint8_t</span> DHT11_Humidity(<span class="keyword">uint8_t</span> *buf)&#123;</span><br><span class="line">    <span class="comment">// </span></span><br><span class="line">    <span class="keyword">return</span> buf[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">uint8_t</span> DHT11_Temperature(<span class="keyword">uint8_t</span> *buf)&#123;</span><br><span class="line">    <span class="comment">// </span></span><br><span class="line">    <span class="keyword">return</span> buf[<span class="number">2</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/06/13/Lab5/" data-id="cjflnn8aw0004expqlyi8j8kn" class="article-share-link">Partager</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Embeded-System/">Embeded System</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Lab6" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/13/Lab6/" class="article-date">
  <time datetime="2016-06-13T07:36:35.000Z" itemprop="datePublished">2016-06-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/13/Lab6/">Lab6 Linux</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id=""><a href="#" class="headerlink" title=""></a></h2><p><img src="http://scn3.github.io/image/lab6/figure1.png" alt=""></p>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h4 id=""><a href="#" class="headerlink" title=""></a></h4><pre><code>- Raspberry Pi2
- 5V/1A
- microUSB
- PC
</code></pre><h4 id=""><a href="#" class="headerlink" title=""></a></h4><pre><code>- 
</code></pre><h2 id=""><a href="#" class="headerlink" title=""></a></h2><h4 id="1-LinuxLinux"><a href="#1-LinuxLinux" class="headerlink" title="1. LinuxLinux"></a>1. LinuxLinux</h4><p><img src="http://scn3.github.io/image/lab6/figure2.png" alt=""></p>
<h4 id="2-"><a href="#2-" class="headerlink" title="2. "></a>2. </h4><pre><code>a) arch/arm/kernelsys_mysyscall.c
</code></pre><p><img src="http://scn3.github.io/image/lab6/figure3.png" alt=""></p>
<pre><code>b) Makefilesys_mysyscall.oobj-y
</code></pre><p><img src="http://scn3.github.io/image/lab6/figure4.png" alt=""></p>
<pre><code>c) arch/arm/kernel/call.S223
</code></pre><p><img src="http://scn3.github.io/image/lab6/figure5.png" alt=""></p>
<pre><code>d) include/uapi/asm-generic/unistd.h223
</code></pre><p><img src="http://scn3.github.io/image/lab6/figure6.png" alt=""></p>
<h4 id="3-"><a href="#3-" class="headerlink" title="3. "></a>3. </h4><pre><code>a) 
KERNEL=kernel7
make ARCH =arm CROSS_COMPILE=arm-linux-gnueabihf- bcm2709_defconfig
b) 
make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- zImage modules dtbs -j4
</code></pre><h4 id="4-"><a href="#4-" class="headerlink" title="4. "></a>4. </h4><p><img src="http://scn3.github.io/image/lab6/figure7.png" alt=""><br><br><br><img src="http://scn3.github.io/image/lab6/figure8.png" alt=""></p>
<h4 id="5-C"><a href="#5-C" class="headerlink" title="5. C"></a>5. C</h4><ol>
<li><br><img src="http://scn3.github.io/image/lab6/figure9.png" alt=""></li>
<li>syscall()<br><img src="http://scn3.github.io/image/lab6/figure10.png" alt=""><br> <br>dmesg | tail -5<br><img src="http://scn3.github.io/image/lab6/figure11.png" alt=""></li>
</ol>
<h4 id="6-"><a href="#6-" class="headerlink" title="6. "></a>6. </h4><p><br><img src="http://scn3.github.io/image/lab6/figure12.png" alt=""></p>
<h4 id="7-insmodlsmod"><a href="#7-insmodlsmod" class="headerlink" title="7. insmodlsmod"></a>7. insmodlsmod</h4><h2 id=""><a href="#" class="headerlink" title=""></a></h2><h4 id="1-"><a href="#1-" class="headerlink" title="1. "></a>1. </h4><p><img src="http://scn3.github.io/image/lab6/figure13.png" alt=""></p>
<h4 id="2-"><a href="#2-" class="headerlink" title="2. "></a>2. </h4><ol>
<li>arch/arm/kernel/call.S<br><img src="http://scn3.github.io/image/lab6/figure14.png" alt=""></li>
<li>include/uapi/asm-generic/unistd.h<br><img src="http://scn3.github.io/image/lab6/figure15.png" alt=""></li>
</ol>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h4 id="1-"><a href="#1-" class="headerlink" title="1. "></a>1. </h4><p><img src="http://scn3.github.io/image/lab6/figure16.png" alt=""><br><img src="http://scn3.github.io/image/lab6/figure17.png" alt=""></p>
<h4 id="2-lsmoddmesg-tail-5"><a href="#2-lsmoddmesg-tail-5" class="headerlink" title="2. lsmoddmesg | tail -5"></a>2. lsmoddmesg | tail -5</h4><p><img src="http://scn3.github.io/image/lab6/figure18.png" alt=""></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/06/13/Lab6/" data-id="cjflnn8ay0006expqhlg836bf" class="article-share-link">Partager</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Embeded-System/">Embeded System</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Lab4" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/13/Lab4/" class="article-date">
  <time datetime="2016-06-13T07:25:06.000Z" itemprop="datePublished">2016-06-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/13/Lab4/">Lab4 bootloader</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id=""><a href="#" class="headerlink" title=""></a></h2><p><img src="http://scn3.github.io/image/lab4/figure1.png" alt=""></p>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h4 id=""><a href="#" class="headerlink" title=""></a></h4><pre><code>- STM32F103
- microUSB
- STLinkbanUSB
</code></pre><h4 id=""><a href="#" class="headerlink" title=""></a></h4><pre><code>- 
</code></pre><h2 id=""><a href="#" class="headerlink" title=""></a></h2><h4 id="STM32"><a href="#STM32" class="headerlink" title="STM32"></a>STM32</h4><h4 id="bootloader"><a href="#bootloader" class="headerlink" title="bootloader:"></a>bootloader:</h4><ol>
<li>peek addraddr</li>
<li>poke addr dataaddrdata<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h4 id=""><a href="#" class="headerlink" title=""></a></h4></li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// </span><span class="function"><span class="keyword">void</span> <span class="title">myPutc</span><span class="params">(<span class="keyword">char</span> ch)</span> </span>&#123;    HAL_UART_Transmit(&amp;huart1,(<span class="keyword">uint8_t</span>*)&amp;ch,<span class="number">1</span>,<span class="number">100</span>);&#125;<span class="comment">// </span><span class="function"><span class="keyword">void</span> <span class="title">myPuts</span><span class="params">(<span class="keyword">char</span> *str)</span> </span>&#123;<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(str); i++)  myPutc(str[i]);&#125;<span class="comment">// time_bound</span><span class="keyword">int8_t</span> myGetc(<span class="keyword">uint8_t</span> *c, <span class="keyword">uint16_t</span> time_bound) &#123;<span class="keyword">while</span> (time_bound) &#123;  <span class="comment">// </span>  <span class="keyword">if</span> (uart_rev.front != uart_rev.rear) &#123;*c = *uart_rev.front;uart_rev.front++;<span class="keyword">if</span> (uart_rev.front &gt;= buf + BUFSIZE)  <span class="comment">// </span>  uart_rev.front = buf;<span class="keyword">return</span> <span class="number">0</span>;  &#125;  time_bound--;&#125;<span class="keyword">return</span> (<span class="keyword">int8_t</span>)  <span class="number">1</span>;&#125;<span class="comment">// </span><span class="keyword">int8_t</span> myGets(<span class="keyword">uint8_t</span> *str, <span class="keyword">uint16_t</span> bound) &#123;<span class="keyword">int</span> count = <span class="number">0</span>;bound--;<span class="keyword">while</span> (count &lt; bound) &#123;  <span class="keyword">if</span> (uart_rev.front != uart_rev.rear) &#123;    <span class="keyword">char</span> ch = *uart_rev.front;    uart_rev.front++;    <span class="keyword">if</span> (uart_rev.front &gt; buf + BUFSIZE)      uart_rev.front = buf;    <span class="keyword">if</span> (ch == <span class="string">'\r'</span>)  <span class="comment">// </span>      <span class="keyword">break</span>;      *str = ch;    <span class="keyword">if</span> (ch != <span class="string">' '</span>) &#123;  <span class="comment">// </span>      str++;      count++;    &#125;  &#125;&#125;*str = <span class="string">'\0'</span>;<span class="keyword">return</span> count;&#125;</span><br></pre></td></tr></table></figure>
<h4 id=""><a href="#" class="headerlink" title=""></a></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">HAL_UART_RxCpltCallback</span><span class="params">(UART_HandleTypeDef  *UartHandle)</span> </span>&#123;  <span class="keyword">uint8_t</span> ret = HAL_OK;    <span class="keyword">char</span> ch = *uart_rev.rear;    myPutc(ch);    <span class="keyword">if</span> (c == <span class="string">'\r'</span>)  <span class="comment">// \n</span>        myPutc(<span class="string">'\n'</span>);        <span class="comment">// buf</span>    uart_rev.rear++;    <span class="keyword">if</span> (uart_rev.rear &gt; buf + BUFSIZE)      uart_rev.rear = buf;    <span class="keyword">if</span> (uart_rev.rear == uart_rev.front) &#123;        uart_rev.front++;    	 <span class="keyword">if</span> (uart_rev.front &gt; buf + BUFSIZE)     		uart_rev.front = buf;    &#125;    <span class="keyword">do</span>&#123;         &#125;<span class="keyword">while</span>(HAL_UART_Receive_IT(UartHandle, uart_rev.rear, <span class="number">1</span>) != HAL_OK);&#125;         <span class="function"><span class="keyword">void</span> <span class="title">USART1_IRQHandler</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;    <span class="comment">//HAL</span>    HAL_UART_IRQHandler(&amp;huart1);&#125;</span><br></pre></td></tr></table></figure>
<h4 id=""><a href="#" class="headerlink" title=""></a></h4><pre><code class="C"><span class="keyword">while</span> (<span class="number">1</span>) {
  <span class="keyword">char</span> cmd[MAXLEN];
  <span class="keyword">char</span> s2[MAXLEN];
  count = <span class="number">0</span>;
  myPuts(<span class="string">"Please input your instruction: "</span>);
  count = myGets((<span class="keyword">uint8_t</span>*)s1, MAXLEN); <span class="comment">// </span>
  <span class="built_in">sscanf</span>(s1, <span class="string">"%s"</span>, cmd);
  <span class="keyword">if</span> (<span class="built_in">strcmp</span>(cmd, <span class="string">"peek"</span>) == <span class="number">0</span>) { <span class="comment">// peek</span>
<span class="keyword">int</span> addr;
<span class="keyword">int</span> res = <span class="built_in">sscanf</span>(s1 + PEEKLEN, %x %s, &amp;addr, s2);
<span class="keyword">if</span> (res == <span class="number">1</span>) {
  <span class="built_in">sprintf</span>(s2, <span class="string">"peek: %x %x\r\n, addr, *((int *)addr)"</span>);
  myPuts(s2);  <span class="comment">// </span>
}
<span class="keyword">else</span> myPuts(<span class="string">"error\r\n"</span>);
  }
  <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(cmd, <span class="string">"poke"</span>) == <span class="number">0</span>) {
<span class="keyword">int</span> addr, data;
<span class="keyword">int</span> res = <span class="built_in">sscanf</span>(str + POKELEN, <span class="string">"%x %x %s"</span>, &amp;addr, &amp;data, s);  
<span class="keyword">if</span> (res == <span class="number">2</span>) {
  *((<span class="keyword">int</span> *)addr) = data; <span class="comment">// </span>
  <span class="built_in">sprintf</span>(s2, <span class="string">"poke: %x %x\r\n"</span>, addr, *((<span class="keyword">int</span> *)addr));
  myPuts(s2); 
}
<span class="keyword">else</span> myPuts(<span class="string">"error\r\n"</span>);  <span class="comment">// </span>
  }
           <span class="keyword">else</span> myPuts(<span class="string">"error\r\n"</span>);   <span class="comment">// peekpoke</span>
}
</code></pre>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2><p> pokepeek</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/06/13/Lab4/" data-id="cjflnn8av0003expq2leklqjh" class="article-share-link">Partager</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Embeded-System/">Embeded System</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Lab3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/12/Lab3/" class="article-date">
  <time datetime="2016-06-13T06:58:57.000Z" itemprop="datePublished">2016-06-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/12/Lab3/">Lab3 </a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id=""><a href="#" class="headerlink" title=""></a></h2><h4 id=""><a href="#" class="headerlink" title=""></a><img src="http://scn3.github.io/image/lab3/figure1.png" alt=""></h4><h4 id="STM32USB"><a href="#STM32USB" class="headerlink" title="STM32USB"></a>STM32USB<img src="http://scn3.github.io/image/lab3/figure2.png" alt=""></h4><h4 id="STM32STLink"><a href="#STM32STLink" class="headerlink" title="STM32STLink"></a>STM32STLink<img src="http://scn3.github.io/image/lab3/figure3.png" alt=""></h4><h4 id=""><a href="#" class="headerlink" title=""></a><img src="http://scn3.github.io/image/lab3/figure4.png" alt=""></h4><h2 id=""><a href="#" class="headerlink" title=""></a></h2><ol>
<li>STM32mdk</li>
<li>CubeUART096008n1HelloPC<br><img src="http://scn3.github.io/image/lab3/figure5.png" alt=""></li>
<li>CubePA11PA12main()PA11Pressed<br><img src="http://scn3.github.io/image/lab3/figure6.png" alt=""></li>
<li>CubePA121PA12count1<br><img src="http://scn3.github.io/image/lab3/figure7.png" alt=""></li>
<li>Cube200ms4count<br><img src="http://scn3.github.io/image/lab3/figure8.png" alt=""></li>
<li>PA12PA11<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h4 id="main-c"><a href="#main-c" class="headerlink" title="main.c"></a>main.c</h4></li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"stm32f1xx_hal.h"</span></span><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"stm32f1xx_hal_uart.h"</span></span><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"stm32f1xx_hal_tim.h"</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SystemClock_Config</span><span class="params">(<span class="keyword">void</span>)</span></span>;<span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Error_Handler</span><span class="params">(<span class="keyword">void</span>)</span></span>;<span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">MX_GPIO_Init</span><span class="params">(<span class="keyword">void</span>)</span></span>;<span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">MX_TIM3_Init</span><span class="params">(<span class="keyword">void</span>)</span></span>;UART_HandleTypeDef UartHandler;TIM_HandleTypeDef TIM_Handler;<span class="keyword">int</span> pa12_interrupt_flag;<span class="keyword">int</span> timer_flag;<span class="keyword">int</span> counter=<span class="number">0</span>;<span class="keyword">int</span> timer_counter=<span class="number">0</span>;<span class="keyword">int</span> mode=<span class="number">0</span>;<span class="keyword">int</span> state1;<span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;  HAL_Init();    <span class="comment">// </span>  SystemClock_Config();  <span class="comment">// </span>  MX_TIM3_Init();  MX_GPIO_Init();    HAL_TIM_Base_Start_IT(&amp;TIM_Handler);	<span class="comment">// UART1</span>  UartHandler.Instance        = USART1;  UartHandler.Init.BaudRate   = <span class="number">9600</span>;  UartHandler.Init.WordLength = UART_WORDLENGTH_8B;  UartHandler.Init.StopBits   = UART_STOPBITS_1;  UartHandler.Init.Parity     = UART_PARITY_NONE;  UartHandler.Init.HwFlowCtl  = UART_HWCONTROL_NONE;  UartHandler.Init.Mode       = UART_MODE_TX_RX;  <span class="comment">// UART</span>	HAL_UART_Init(&amp;UartHandler);		HAL_Delay(<span class="number">100</span>);  <span class="built_in">printf</span>(<span class="string">"Hello\r\n"</span>);  <span class="comment">// hello</span>  <span class="keyword">int</span> flag = <span class="number">0</span>;  	HAL_SuspendTick();		<span class="keyword">while</span> (<span class="number">1</span>) &#123;   <span class="comment">// PA11</span>		state1 = HAL_GPIO_ReadPin(GPIOA,GPIO_PIN_11);		<span class="keyword">if</span>(state1==<span class="number">0</span>) <span class="comment">// PA11</span>			mode = ~mode;		&#125;&#125;<span class="keyword">int</span> __io_putchar(<span class="keyword">uint8_t</span> ch)&#123;  <span class="comment">// </span>	HAL_UART_Transmit(&amp;UartHandler, &amp;ch, <span class="number">1</span>, <span class="number">100</span>);	<span class="keyword">return</span> <span class="number">1</span>;&#125;<span class="function"><span class="keyword">int</span> <span class="title">fputc</span><span class="params">(<span class="keyword">int</span> ch, FILE *f)</span></span>&#123;	<span class="keyword">uint8_t</span> chr =ch;	HAL_UART_Transmit(&amp;UartHandler, &amp;chr, <span class="number">1</span>, <span class="number">100</span>);	<span class="keyword">return</span> <span class="number">1</span>;&#125;<span class="function"><span class="keyword">void</span> <span class="title">HAL_TIM_PeriodElapsedCallback</span><span class="params">(TIM_HandleTypeDef *htim)</span></span>&#123;  <span class="comment">// </span>    <span class="keyword">if</span>(htim-&gt;Instance == TIM3)&#123;                timer_flag = <span class="number">1</span>;        timer_counter++;    &#125;		<span class="keyword">if</span> (mode)  <span class="comment">// </span>			<span class="built_in">printf</span>(<span class="string">"speed=%lf\r\n"</span>, counter*<span class="number">1.0</span>/timer_counter);		<span class="keyword">else</span>   <span class="comment">// </span>			<span class="built_in">printf</span>(<span class="string">"distance=%d\r\n"</span>, counter);&#125;<span class="function"><span class="keyword">void</span> <span class="title">HAL_GPIO_EXTI_Callback</span><span class="params">(uint16_t GPIO_Pin)</span></span>&#123;	<span class="keyword">switch</span> (GPIO_Pin)&#123;		<span class="keyword">case</span> GPIO_PIN_11:			<span class="built_in">printf</span>(<span class="string">"Pressed\r\n"</span>);			mode=!mode;			<span class="keyword">break</span>;		<span class="keyword">case</span> GPIO_PIN_12:			counter++;			<span class="keyword">break</span>;	&#125;&#125;<span class="comment">/** System Clock Configuration*/</span><span class="function"><span class="keyword">void</span> <span class="title">SystemClock_Config</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;  RCC_OscInitTypeDef RCC_OscInitStruct;  RCC_ClkInitTypeDef RCC_ClkInitStruct;  RCC_OscInitStruct.OscillatorType = RCC_OSCILLATORTYPE_HSI;  RCC_OscInitStruct.HSIState = RCC_HSI_ON;  RCC_OscInitStruct.HSICalibrationValue = <span class="number">16</span>;  RCC_OscInitStruct.PLL.PLLState = RCC_PLL_NONE;  HAL_RCC_OscConfig(&amp;RCC_OscInitStruct);  RCC_ClkInitStruct.ClockType = RCC_CLOCKTYPE_SYSCLK;  RCC_ClkInitStruct.SYSCLKSource = RCC_SYSCLKSOURCE_HSI;  RCC_ClkInitStruct.AHBCLKDivider = RCC_SYSCLK_DIV1;  RCC_ClkInitStruct.APB1CLKDivider = RCC_HCLK_DIV1;  RCC_ClkInitStruct.APB2CLKDivider = RCC_HCLK_DIV1;  HAL_RCC_ClockConfig(&amp;RCC_ClkInitStruct, FLASH_LATENCY_0);  HAL_SYSTICK_Config(HAL_RCC_GetHCLKFreq()/<span class="number">1000</span>);  HAL_SYSTICK_CLKSourceConfig(SYSTICK_CLKSOURCE_HCLK);&#125;<span class="comment">// </span><span class="function"><span class="keyword">void</span> <span class="title">MX_TIM3_Init</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;  TIM_ClockConfigTypeDef sClockSourceConfig;  TIM_MasterConfigTypeDef sMasterConfig;  TIM_Handler.Instance = TIM3;  TIM_Handler.Init.Prescaler = <span class="number">8000</span>;  TIM_Handler.Init.CounterMode = TIM_COUNTERMODE_UP;  TIM_Handler.Init.Period = <span class="number">199</span>;  TIM_Handler.Init.ClockDivision = TIM_CLOCKDIVISION_DIV1;  HAL_TIM_Base_Init(&amp;TIM_Handler);  sClockSourceConfig.ClockSource = TIM_CLOCKSOURCE_INTERNAL;  HAL_TIM_ConfigClockSource(&amp;TIM_Handler, &amp;sClockSourceConfig);  sMasterConfig.MasterOutputTrigger = TIM_TRGO_RESET;  sMasterConfig.MasterSlaveMode = TIM_MASTERSLAVEMODE_DISABLE;  HAL_TIMEx_MasterConfigSynchronization(&amp;TIM_Handler, &amp;sMasterConfig);&#125;<span class="comment">// GPIO</span><span class="function"><span class="keyword">void</span> <span class="title">MX_GPIO_Init</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;  GPIO_InitTypeDef GPIO_InitStruct;	  __GPIOA_CLK_ENABLE();    GPIO_InitStruct.Pin = GPIO_PIN_11;	GPIO_InitStruct.Mode = GPIO_MODE_INPUT;  <span class="comment">//GPIO_InitStruct.Mode = GPIO_MODE_IT_FALLING;</span>  GPIO_InitStruct.Pull = GPIO_PULLUP;  GPIO_InitStruct.Speed = GPIO_SPEED_LOW;  HAL_GPIO_Init(GPIOA, &amp;GPIO_InitStruct);    GPIO_InitStruct.Pin = GPIO_PIN_12;  GPIO_InitStruct.Mode = GPIO_MODE_IT_FALLING;  GPIO_InitStruct.Pull = GPIO_PULLUP;  GPIO_InitStruct.Speed = GPIO_SPEED_LOW;  HAL_GPIO_Init(GPIOA, &amp;GPIO_InitStruct);    HAL_NVIC_SetPriority(EXTI15_10_IRQn,<span class="number">0</span>,<span class="number">0</span>);  HAL_NVIC_EnableIRQ(EXTI15_10_IRQn);&#125;<span class="meta">#<span class="meta-keyword">ifdef</span> USE_FULL_ASSERT</span><span class="comment">/**   * @brief Reports the name of the source file and the source line number   * where the assert_param error has occurred.   * @param file: pointer to the source file name   * @param line: assert_param error line source number   * @retval None   */</span><span class="function"><span class="keyword">void</span> <span class="title">assert_failed</span><span class="params">(uint8_t* file, uint32_t line)</span></span>&#123;  <span class="comment">/* User can add his own implementation to report the file name and line number,    ex: printf("Wrong parameters value: file %s on line %d\r\n", file, line) */</span>&#125;<span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<h4 id="stm32f1xx-hal-msp-c"><a href="#stm32f1xx-hal-msp-c" class="headerlink" title="stm32f1xx_hal_msp.c"></a>stm32f1xx_hal_msp.c</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">HAL_MspInit</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;  __HAL_RCC_AFIO_CLK_ENABLE();  HAL_NVIC_SetPriorityGrouping(NVIC_PRIORITYGROUP_4);  <span class="comment">/* System interrupt init*/</span><span class="comment">/* SysTick_IRQn interrupt configuration */</span>  HAL_NVIC_SetPriority(SysTick_IRQn, <span class="number">0</span>, <span class="number">0</span>);    <span class="comment">/**DISABLE: JTAG-DP Disabled and SW-DP Disabled     */</span>  &#125;<span class="comment">// </span><span class="function"><span class="keyword">void</span> <span class="title">HAL_UART_MspInit</span><span class="params">(UART_HandleTypeDef *huart)</span></span>&#123;	__HAL_RCC_GPIOA_CLK_ENABLE();	__HAL_RCC_USART1_CLK_ENABLE();		GPIO_InitTypeDef GPIO_InitStruct;	GPIO_InitStruct.Pin = GPIO_PIN_9;	GPIO_InitStruct.Mode = GPIO_MODE_AF_PP;	GPIO_InitStruct.Speed = GPIO_SPEED_HIGH;	HAL_GPIO_Init(GPIOA, &amp;GPIO_InitStruct);	GPIO_InitStruct.Pin = GPIO_PIN_10;	HAL_GPIO_Init(GPIOA, &amp;GPIO_InitStruct);&#125;<span class="comment">// </span><span class="function"><span class="keyword">void</span> <span class="title">HAL_UART_MspDeInit</span><span class="params">(UART_HandleTypeDef *huart)</span></span>&#123;	__HAL_RCC_USART1_FORCE_RESET();	__HAL_RCC_USART1_RELEASE_RESET();	HAL_GPIO_DeInit(GPIOA, GPIO_PIN_9);	HAL_GPIO_DeInit(GPIOA, GPIO_PIN_10);&#125;<span class="comment">// </span><span class="function"><span class="keyword">void</span> <span class="title">HAL_TIM_Base_MspInit</span><span class="params">(TIM_HandleTypeDef* htim_base)</span></span>&#123;  <span class="keyword">if</span>(htim_base-&gt;Instance==TIM3)  &#123;    __TIM3_CLK_ENABLE();    HAL_NVIC_SetPriority(TIM3_IRQn, <span class="number">0</span>, <span class="number">0</span>);    HAL_NVIC_EnableIRQ(TIM3_IRQn);  &#125;&#125;<span class="comment">// </span><span class="function"><span class="keyword">void</span> <span class="title">HAL_TIM_Base_MspDeInit</span><span class="params">(TIM_HandleTypeDef* htim_base)</span> </span>&#123;  <span class="keyword">if</span>(htim_base-&gt;Instance==TIM3)  &#123;    __TIM3_CLK_DISABLE();    HAL_NVIC_DisableIRQ(TIM3_IRQn);  &#125;&#125;</span><br></pre></td></tr></table></figure>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2><p><img src="http://scn3.github.io/image/lab3/figure9.png" alt=""><br>STM32resetHelloP11PA11Pressed</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/06/12/Lab3/" data-id="cjflnn8ar0001expqgbbo7t0h" class="article-share-link">Partager</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Embeded-System/">Embeded System</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Lab2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/12/Lab2/" class="article-date">
  <time datetime="2016-06-13T06:19:59.000Z" itemprop="datePublished">2016-06-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/12/Lab2/">Lab2 ARM</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id=""><a href="#" class="headerlink" title=""></a></h2><p>macbook pro</p>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2><p>macbook</p>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2><ol>
<li>ThumbARM<ul>
<li>C<br><img src="http://scn3.github.io/image/lab2/figure1.png" alt=""></li>
<li>ARMthumb<br><br>ARM<br><img src="http://scn3.github.io/image/lab2/figure2.png" alt=""><br><br>-mthumbthumb<br><img src="http://scn3.github.io/image/lab2/figure3.png" alt=""></li>
<li><br><br>arm-linux-gnueabi-objdump d <br><br>ARM<br><img src="http://scn3.github.io/image/lab2/figure4.png" alt=""><br><br>thumb<br><img src="http://scn3.github.io/image/lab2/figure5.png" alt=""><br><br>ARMThumb3216ThumbARMARMThumbls l<br><img src="http://scn3.github.io/image/lab2/figure6.png" alt=""></li>
</ul>
</li>
<li>ARM<ul>
<li>C<br><img src="http://scn3.github.io/image/lab2/figure7.png" alt=""></li>
<li>ARM<br><img src="http://scn3.github.io/image/lab2/figure8.png" alt=""><br><br>8454ble</li>
</ul>
</li>
<li>C<ul>
<li>C<br><img src="http://scn3.github.io/image/lab2/figure9.png" alt=""></li>
<li>-O<br><img src="http://scn3.github.io/image/lab2/figure10.png" alt=""></li>
<li>ARM<br><img src="http://scn3.github.io/image/lab2/figure11.png" alt=""><br> <br>84a4</li>
</ul>
</li>
<li>C32<ul>
<li>C<br><img src="http://scn3.github.io/image/lab2/figure12.png" alt=""></li>
<li>ARM<br> <img src="http://scn3.github.io/image/lab2/figure13.png" alt=""><br> <br>328460ldrr3</li>
</ul>
</li>
<li>C<ul>
<li>C<br><img src="http://scn3.github.io/image/lab2/figure14.png" alt=""></li>
<li>ARM<br><img src="http://scn3.github.io/image/lab2/figure15.png" alt=""><br><img src="http://scn3.github.io/image/lab2/figure16.png" alt=""><br><br><br>  <br>a)    lrbllr<br>  <br>b)    r0r1<br>  <br>c)    fp<br>  <br>d)    r0-r3callerr4callee</li>
</ul>
</li>
<li>CMLA<ul>
<li>C<br><img src="http://scn3.github.io/image/lab2/figure17.png" alt=""></li>
<li>ARM-O<br><img src="http://scn3.github.io/image/lab2/figure18.png" alt=""><br><br>84acmla</li>
</ul>
</li>
<li>CBIC<ul>
<li>C<br><img src="http://scn3.github.io/image/lab2/figure19.png" alt=""></li>
<li>ARM-O<br><img src="http://scn3.github.io/image/lab2/figure20.png" alt=""><br><br>84a0bic</li>
</ul>
</li>
<li>C printf()nnCmain() <ul>
<li>puts<br><img src="http://scn3.github.io/image/lab2/figure21.png" alt=""></li>
</ul>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/06/12/Lab2/" data-id="cjflnn8an0000expqn7nu844j" class="article-share-link">Partager</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Embeded-System/">Embeded System</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Starting-with-your-Raspberry-Pi" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/14/Starting-with-your-Raspberry-Pi/" class="article-date">
  <time datetime="2016-03-14T12:46:30.000Z" itemprop="datePublished">2016-03-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/14/Starting-with-your-Raspberry-Pi/">Lab 1 </a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="install-Raspbian-OS-for-Raspberry-Pi"><a href="#install-Raspbian-OS-for-Raspberry-Pi" class="headerlink" title="install Raspbian OS for Raspberry Pi"></a>install Raspbian OS for Raspberry Pi</h2><ol>
<li><p>Download an img file from <a href="https://www.raspberrypi.org/downloads" target="_blank" rel="external">https://www.raspberrypi.org/downloads</a> </p>
</li>
<li><p>Insert  SD card and write the img file to the card. <br> We can use terminal and enter instructions as follows: <img src="http://scn3.github.io/image/Starting-with-your-Raspberry-Pi/figure1.png" alt=""><br><strong>Notice</strong>: If your failed to write to your SD card with dd instruction, please check if you have permission to write to your SD card. If your permission is only reading, your can insert your SD card violently. More approaches to solve it: <a href="http://bbs.feng.com/read-htm-tid-3495425.html" target="_blank" rel="external">http://bbs.feng.com/read-htm-tid-3495425.html</a></p>
</li>
</ol>
<h2 id="Connect-to-Raspberry-Pi-with-serial-port"><a href="#Connect-to-Raspberry-Pi-with-serial-port" class="headerlink" title="Connect to Raspberry Pi with serial port"></a>Connect to Raspberry Pi with serial port</h2><ol>
<li>The Serial Port on Raspberry Pi is shown as following:<br><br><img src="http://scn3.github.io/image/Starting-with-your-Raspberry-Pi/figure2.png" alt=""> <br><br>We can connect it as following(While  TXD; Green  RXD; Black  GND):<br><br><img src="http://scn3.github.io/image/Starting-with-your-Raspberry-Pi/figure3.JPG" alt=""> <br></li>
<li><p>Install a serial driver if you havent installed one. (downloaded from <a href="http://www.prolic.com.tw/" target="_blank" rel="external">http://www.prolic.com.tw/</a>) <br><br>Find your serial port and install screen if it hasnt been installed. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls /dev/tty.*</span><br><span class="line">brew install screen</span><br></pre></td></tr></table></figure>
</li>
<li><p>Connect to your Raspberry</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">screen /dev/tty.usbserial 115200</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>Then you can see the infomation about booting of Raspberry as following: <br><br><img src="http://scn3.github.io/image/Starting-with-your-Raspberry-Pi/figure4.png" alt=""></p>
<h2 id="Connect-to-Raspberry-Pi-with-LAN"><a href="#Connect-to-Raspberry-Pi-with-LAN" class="headerlink" title="Connect to Raspberry Pi with LAN"></a>Connect to Raspberry Pi with LAN</h2><ol>
<li>Connect Raspberry Pi to router with cable and connect your Macbook to corresponding LAN.</li>
<li>Test connection on Mac<img src="http://scn3.github.io/image/Starting-with-your-Raspberry-Pi/figure5.png" alt=""></li>
<li>Connect to Raspberry <img src="http://scn3.github.io/image/Starting-with-your-Raspberry-Pi/figure6.png" alt=""></li>
<li>Test connection on Raspbian <img src="http://scn3.github.io/image/Starting-with-your-Raspberry-Pi/figure7.png" alt=""></li>
</ol>
<h2 id="Cross-compiling-on-Ubuntu"><a href="#Cross-compiling-on-Ubuntu" class="headerlink" title="Cross compiling(on Ubuntu)"></a>Cross compiling(on Ubuntu)</h2><ol>
<li><p>Install compiler </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install gcc-arm-linux-gnueabi make ncurses-dev</span><br></pre></td></tr></table></figure>
</li>
<li><p>Write program<br><img src="http://scn3.github.io/image/Starting-with-your-Raspberry-Pi/figure8.png" alt=""></p>
</li>
<li><p>Compile</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arm-linux-gnueabi-gcc hello.c</span><br></pre></td></tr></table></figure>
</li>
<li><p>Send it to Raspberry</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp a.out pi@192.168.1.101:~/hello.out</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><img src="http://scn3.github.io/image/Starting-with-your-Raspberry-Pi/figure9.png" alt=""><br>5.Run the program on Raspberry Pi<br><img src="http://scn3.github.io/image/Starting-with-your-Raspberry-Pi/figure10.png" alt=""><br>  Successfully!</p>
<h2 id="Booting-content"><a href="#Booting-content" class="headerlink" title="Booting content"></a>Booting content</h2><p>Uncompressing Linux done, booting the kernel.<br>[    0.000000] Booting Linux on physical CPU 0x0<br>[    0.000000] Initializing cgroup subsys cpuset<br>[    0.000000] Initializing cgroup subsys cpu<br>[    0.000000] Initializing cgroup subsys cpuacct<br>[    0.000000] Linux version 4.1.18+ (dc4@dc4-XPS13-9333) (gcc version 4.9.3 (c6<br>[    0.000000] CPU: ARMv6-compatible processor [410fb767] revision 7 (ARMv7), cd<br>[    0.000000] CPU: PIPT / VIPT nonaliasing data cache, VIPT nonaliasing instrue<br>[    0.000000] Machine model: Raspberry Pi Model B Rev 2<br>[    0.000000] cma: Reserved 8 MiB at 0x1b400000<br>[    0.000000] Memory policy: Data cache writeback<br>[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pa0<br>[    0.000000] Kernel command line: dma.dmachans=0x7f35 bcm2708_fb.fbwidth=656 t<br>[    0.000000] PID hash table entries: 2048 (order: 1, 8192 bytes)<br>[    0.000000] Dentry cache hash table entries: 65536 (order: 6, 262144 bytes)<br>[    0.000000] Inode-cache hash table entries: 32768 (order: 5, 131072 bytes)<br>[    0.000000] Memory: 436836K/458752K available (5792K kernel code, 488K rwdat)<br>[    0.000000] Virtual kernel memory layout:<br>[    0.000000]     vector  : 0xffff0000 - 0xffff1000   (   4 kB)<br>[    0.000000]     fixmap  : 0xffc00000 - 0xfff00000   (3072 kB)<br>[    0.000000]     vmalloc : 0xdc800000 - 0xff000000   ( 552 MB)<br>[    0.000000]     lowmem  : 0xc0000000 - 0xdc000000   ( 448 MB)<br>[    0.000000]     modules : 0xbf000000 - 0xc0000000   (  16 MB)<br>[    0.000000]       .text : 0xc0008000 - 0xc076f1f0   (7581 kB)<br>[    0.000000]       .init : 0xc0770000 - 0xc07c8000   ( 352 kB)<br>[    0.000000]       .data : 0xc07c8000 - 0xc0842260   ( 489 kB)<br>[    0.000000]        .bss : 0xc0842260 - 0xc08f63e0   ( 721 kB)<br>[    0.000000] SLUB: HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1<br>[    0.000000] NR_IRQS:522<br>[    0.000000] clocksource stc: mask: 0xffffffff max_cycles: 0xffffffff, max_ids<br>[    0.000016] sched_clock: 32 bits at 1000kHz, resolution 1000ns, wraps every s<br>[    0.000057] Switching to timer-based delay loop, resolution 1000ns<br>[    0.000345] Console: colour dummy device 80x30<br>[    0.001272] console [tty1] enabled<br>[    0.001329] Calibrating delay loop (skipped), value calculated using timer f)<br>[    0.001415] pid_max: default: 32768 minimum: 301<br>[    0.001796] Mount-cache hash table entries: 1024 (order: 0, 4096 bytes)<br>[    0.001867] Mountpoint-cache hash table entries: 1024 (order: 0, 4096 bytes)<br>[    0.002923] Initializing cgroup subsys blkio<br>[    0.003017] Initializing cgroup subsys memory<br>[    0.003086] Initializing cgroup subsys devices<br>[    0.003151] Initializing cgroup subsys freezer<br>[    0.003212] Initializing cgroup subsys net_cls<br>[    0.003329] CPU: Testing write buffer coherency: ok<br>[    0.003449] ftrace: allocating 19747 entries in 58 pages<br>[    0.107987] Setting up static identity map for 0x81c0 - 0x81f8<br>[    0.110179] devtmpfs: initialized<br>[    0.121007] VFP support v0.3: implementor 41 architecture 1 part 20 variant 5<br>[    0.121462] clocksource jiffies: mask: 0xffffffff max_cycles: 0xffffffff, mas<br>[    0.123475] pinctrl core: initialized pinctrl subsystem<br>[    0.124379] NET: Registered protocol family 16<br>[    0.129874] DMA: preallocated 4096 KiB pool for atomic coherent allocations<br>[    0.131376] bcm2708.uart_clock = 3000000<br>[    0.136262] hw-breakpoint: found 6 breakpoint and 1 watchpoint registers.<br>[    0.136341] hw-breakpoint: maximum watchpoint size is 4 bytes.<br>[    0.136549] Serial: AMBA PL011 UART driver<br>[    0.136851] 20201000.uart: ttyAMA0 at MMIO 0x20201000 (irq = 83, base_baud =2<br>[    0.504867] console [ttyAMA0] enabled<br>[    0.509270] bcm2835-mbox 2000b880.mailbox: mailbox enabled<br>[    0.555239] bcm2708-dmaengine 20007000.dma: DMA legacy API manager at f200705<br>[    0.563970] bcm2708-dmaengine 20007000.dma: Initialized 7 DMA channels (+ 1 )<br>[    0.572537] bcm2708-dmaengine 20007000.dma: Load BCM2835 DMA engine driver<br>[    0.579467] bcm2708-dmaengine 20007000.dma: dma_debug:0<br>[    0.585617] SCSI subsystem initialized<br>[    0.589781] usbcore: registered new interface driver usbfs<br>[    0.595503] usbcore: registered new interface driver hub<br>[    0.601035] usbcore: registered new device driver usb<br>[    0.607059] raspberrypi-firmware soc:firmware: Attached to firmware from 2015<br>[    0.642750] Switched to clocksource stc<br>[    0.695940] FS-Cache: Loaded<br>[    0.699246] CacheFiles: Loaded<br>[    0.718043] NET: Registered protocol family 2<br>[    0.723981] TCP established hash table entries: 4096 (order: 2, 16384 bytes)<br>[    0.731171] TCP bind hash table entries: 4096 (order: 2, 16384 bytes)<br>[    0.737806] TCP: Hash tables configured (established 4096 bind 4096)<br>[    0.744448] UDP hash table entries: 256 (order: 0, 4096 bytes)<br>[    0.750345] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)<br>[    0.757037] NET: Registered protocol family 1<br>[    0.762009] RPC: Registered named UNIX socket transport module.<br>[    0.768067] RPC: Registered udp transport module.<br>[    0.772841] RPC: Registered tcp transport module.<br>[    0.777576] RPC: Registered tcp NFSv4.1 backchannel transport module.<br>[    0.785293] hw perfevents: enabled with armv6_1176 PMU driver, 3 counters ave<br>[    0.794424] futex hash table entries: 256 (order: -1, 3072 bytes)<br>[    0.816876] VFS: Disk quotas dquot_6.6.0<br>[    0.821259] VFS: Dquot-cache hash table entries: 1024 (order 0, 4096 bytes)<br>[    0.830944] FS-Cache: Netfs nfs registered for caching<br>[    0.837706] NFS: Registering the id_resolver key type<br>[    0.843012] Key type id_resolver registered<br>[    0.847236] Key type id_legacy registered<br>[    0.855071] Block layer SCSI generic (bsg) driver version 0.4 loaded (major )<br>[    0.863073] io scheduler noop registered<br>[    0.867075] io scheduler deadline registered (default)<br>[    0.872649] io scheduler cfq registered<br>[    0.879094] BCM2708FB: allocated DMA memory 5b800000<br>[    0.884268] BCM2708FB: allocated DMA channel 0 @ f2007000<br>[    0.894833] Console: switching to colour frame buffer device 82x26<br>[    0.906093] Serial: 8250/16550 driver, 0 ports, IRQ sharing disabled<br>[    0.915871] vc-cma: Videocore CMA driver<br>[    0.921553] vc-cma: vc_cma_base      = 0x00000000<br>[    0.928009] vc-cma: vc_cma_size      = 0x00000000 (0 MiB)<br>[    0.935087] vc-cma: vc_cma_initial   = 0x00000000 (0 MiB)<br>[    0.942383] vc-mem: phys_addr:0x00000000 mem_base=0x1ec00000 mem_size:0x2000)<br>[    0.973033] brd: module loaded<br>[    0.986854] loop: module loaded<br>[    0.992666] vchiq: vchiq_init_state: slot_zero = 0xdb880000, is_master = 0<br>[    1.003220] Loading iSCSI transport class v2.0-870.<br>[    1.011298] usbcore: registered new interface driver smsc95xx<br>[    1.018962] dwc_otg: version 3.00a 10-AUG-2012 (platform bus)<br>[    1.226642] Core Release: 2.80a<br>[    1.231335] Setting default values for core params<br>[    1.237715] Finished setting default values for core params<br>[    1.445134] Using Buffer DMA mode<br>[    1.450034] Periodic Transfer Interrupt Enhancement - disabled<br>[    1.457472] Multiprocessor Interrupt Enhancement - disabled<br>[    1.464698] OTG VER PARAM: 0, OTG VER FLAG: 0<br>[    1.470686] Dedicated Tx FIFOs mode<br>[    1.476278] WARN::dwc_otg_hcd_init:1047: FIQ DMA bounce buffers: virt = 0xdb4<br>[    1.489426] FIQ FSM acceleration enabled for :<br>[    1.489426] Non-periodic Split Transactions<br>[    1.489426] Periodic Split Transactions<br>[    1.489426] High-Speed Isochronous Endpoints<br>[    1.512817] WARN::hcd_init_fiq:412: FIQ on core 0 at 0xc03dd6ac<br>[    1.520402] WARN::hcd_init_fiq:413: FIQ ASM at 0xc03dd988 length 36<br>[    1.528316] WARN::hcd_init_fiq:438: MPHI regs_base at 0xdc896000<br>[    1.536032] dwc_otg 20980000.usb: DWC OTG Controller<br>[    1.542644] dwc_otg 20980000.usb: new USB bus registered, assigned bus numbe1<br>[    1.551680] dwc_otg 20980000.usb: irq 32, io mem 0x00000000<br>[    1.558917] Init: Port Power? op_state=1<br>[    1.564448] Init: Power Port (0)<br>[    1.569538] usb usb1: New USB device found, idVendor=1d6b, idProduct=0002<br>[    1.578011] usb usb1: New USB device strings: Mfr=3, Product=2, SerialNumber1<br>[    1.586872] usb usb1: Product: DWC OTG Controller<br>[    1.593185] usb usb1: Manufacturer: Linux 4.1.18+ dwc_otg_hcd<br>[    1.600498] usb usb1: SerialNumber: 20980000.usb<br>[    1.607728] hub 1-0:1.0: USB hub found<br>[    1.613225] hub 1-0:1.0: 1 port detected<br>[    1.619892] usbcore: registered new interface driver usb-storage<br>[    1.627994] mousedev: PS/2 mouse device common for all mice<br>[    1.636243] bcm2835-cpufreq: min=700000 max=700000<br>[    1.643005] sdhci: Secure Digital Host Controller Interface driver<br>[    1.650757] sdhci: Copyright(c) Pierre Ossman<br>[    1.657114] sdhost: log_buf @ db813000 (5b813000)<br>[    1.742828] mmc0: sdhost-bcm2835 loaded - DMA enabled (&gt;1)<br>[    1.750481] sdhci-pltfm: SDHCI platform and OF driver helper<br>[    1.778709] ledtrig-cpu: registered to indicate activity on CPUs<br>[    1.786677] hidraw: raw HID events driver (C) Jiri Kosina<br>[    1.794062] usbcore: registered new interface driver usbhid<br>[    1.801233] usbhid: USB HID core driver<br>[    1.811183] Initializing XFRM netlink socket<br>[    1.817349] Indeed it is in host mode hprt0 = 00021501<br>[    1.884644] NET: Registered protocol family 17<br>[    1.891073] Key type dns_resolver registered<br>[    1.904882] registered taskstats version 1<br>[    1.911013] vc-sm: Videocore shared memory driver<br>[    1.917611] [vc_sm_connected_init]: start<br>[    1.924708] [vc_sm_connected_init]: end - returning 0<br>[    1.933922] Waiting for root device /dev/mmcblk0p2<br>[    1.950491] mmc0: host does not support reading read-only switch, assuming we<br>[    1.963758] mmc0: new high speed SDHC card at address 0007<br>[    1.971747] mmcblk0: mmc0:0007 SD16G 14.5 GiB<br>[    1.979884]  mmcblk0: p1 p2<br>[    2.046030] EXT4-fs (mmcblk0p2): INFO: recovery required on readonly filesysm<br>[    2.055226] EXT4-fs (mmcblk0p2): write access will be enabled during recovery<br>[    2.064135] usb 1-1: new high-speed USB device number 2 using dwc_otg<br>[    2.072444] Indeed it is in host mode hprt0 = 00001101<br>[    2.273232] usb 1-1: New USB device found, idVendor=0424, idProduct=9512<br>[    2.281773] usb 1-1: New USB device strings: Mfr=0, Product=0, SerialNumber=0<br>[    2.291811] hub 1-1:1.0: USB hub found<br>[    2.297586] hub 1-1:1.0: 3 ports detected<br>[    2.582820] usb 1-1.1: new high-speed USB device number 3 using dwc_otg<br>[    2.703234] usb 1-1.1: New USB device found, idVendor=0424, idProduct=ec00<br>[    2.711890] usb 1-1.1: New USB device strings: Mfr=0, Product=0, SerialNumbe0<br>[    2.724104] smsc95xx v1.0.4<br>[    2.787287] smsc95xx 1-1.1:1.0 eth0: register smsc95xx at usb-20980000.usb6<br>[    6.670212] EXT4-fs (mmcblk0p2): recovery complete<br>[    7.754578] EXT4-fs (mmcblk0p2): mounted filesystem with ordered data mode. )<br>[    7.766455] VFS: Mounted root (ext4 filesystem) readonly on device 179:2.<br>[    7.785063] devtmpfs: mounted<br>[    7.791036] Freeing unused kernel memory: 352K (c0770000 - c07c8000)<br>[    8.120043] random: systemd urandom read with 71 bits of entropy available<br>[    8.135687] systemd[1]: systemd 215 running in system mode. (+PAM +AUDIT +SE)<br>[    8.153763] systemd[1]: Detected architecture arm.<br>[    8.278334] NET: Registered protocol family 10<br>[    8.287127] systemd[1]: Inserted module ipv6<br>[    8.298320] systemd[1]: Set hostname to <raspberrypi>.<br>[    8.485186] uart-pl011 20201000.uart: no DMA platform data<br>[    8.962076] systemd[1]: Cannot add dependency job for unit display-manager.s.<br>[    8.988689] systemd[1]: Starting Forward Password Requests to Wall Directory.<br>[    9.001240] systemd[1]: Started Forward Password Requests to Wall Directory .<br>[    9.013104] systemd[1]: Expecting device dev-ttyAMA0.device<br>[    9.024126] systemd[1]: Starting Remote File Systems (Pre).<br>[    9.034594] systemd[1]: Reached target Remote File Systems (Pre).<br>[    9.043094] systemd[1]: Starting Encrypted Volumes.<br>[    9.052638] systemd[1]: Reached target Encrypted Volumes.<br>[    9.060463] systemd[1]: Starting Arbitrary Executable File Formats File Syst.<br>[    9.076922] systemd[1]: Set up automount Arbitrary Executable File Formats F.<br>[    9.090928] systemd[1]: Starting Swap.<br>[    9.099740] systemd[1]: Reached target Swap.<br>[    9.106342] systemd[1]: Expecting device dev-mmcblk0p1.device<br>[    9.117122] systemd[1]: Starting Root Slice.<br>[    9.126193] systemd[1]: Created slice Root Slice.<br>[    9.133051] systemd[1]: Starting User and Session Slice.<br>[    9.143320] systemd[1]: Created slice User and Session Slice.<br>[    9.151125] systemd[1]: Starting /dev/initctl Compatibility Named Pipe.<br>[    9.162726] systemd[1]: Listening on /dev/initctl Compatibility Named Pipe.<br>[    9.171903] systemd[1]: Starting Delayed Shutdown Socket.<br>[    9.182171] systemd[1]: Listening on Delayed Shutdown Socket.<br>[    9.190086] systemd[1]: Starting Journal Socket (/dev/log).<br>[    9.200511] systemd[1]: Listening on Journal Socket (/dev/log).<br>[    9.208573] systemd[1]: Starting udev Control Socket.<br>[    9.218357] systemd[1]: Listening on udev Control Socket.<br>[    9.225922] systemd[1]: Starting udev Kernel Socket.<br>[    9.235508] systemd[1]: Listening on udev Kernel Socket.<br>[    9.242979] systemd[1]: Starting Journal Socket.<br>[    9.252291] systemd[1]: Listening on Journal Socket.<br>[    9.259542] systemd[1]: Starting System Slice.<br>[    9.268783] systemd[1]: Created slice System Slice.<br>[    9.275886] systemd[1]: Starting File System Check on Root Device<br>[    9.291574] systemd[1]: Starting system-systemd\x2dfsck.slice.<br>[    9.312581] systemd[1]: Created slice system-systemd\x2dfsck.slice.<br>[    9.327037] systemd[1]: Starting system-getty.slice.<br>[    9.342243] systemd[1]: Created slice system-getty.slice.<br>[    9.351208] systemd[1]: Starting system-serial\x2dgetty.slice.<br>[    9.367031] systemd[1]: Created slice system-serial\x2dgetty.slice.<br>[    9.376451] systemd[1]: Starting Increase datagram queue length<br>[    9.402038] systemd[1]: Starting Restore / save the current clock<br>[    9.440522] systemd[1]: Starting udev Coldplug all Devices<br>[    9.524329] systemd[1]: Started Set Up Additional Binary Formats.<br>[    9.555768] systemd[1]: Starting Load Kernel Modules<br>[    9.599453] systemd[1]: Mounting POSIX Message Queue File System<br>[    9.681169] systemd[1]: Mounting Debug File System<br>[    9.797873] systemd[1]: Mounted Huge Pages File System.<br>[    9.815399] systemd[1]: Starting Create list of required static device nodes.<br>[    9.860999] systemd[1]: Starting Slices.<br>[    9.887329] systemd[1]: Reached target Slices.<br>[    9.918267] systemd[1]: Mounted Debug File System.<br>[    9.928122] systemd[1]: Mounted POSIX Message Queue File System.<br>[    9.941558] systemd[1]: Started File System Check on Root Device.<br>[    9.969750] systemd[1]: Started Increase datagram queue length.<br>[    9.983089] systemd[1]: Started Restore / save the current clock.<br>[   10.013142] systemd[1]: Started Load Kernel Modules.<br>[   10.037897] systemd[1]: Started Create list of required static device nodes .<br>[   10.079575] systemd[1]: Time has been changed<br>[   10.192665] systemd[1]: Started udev Coldplug all Devices.<br>[   10.414316] systemd[1]: Starting Create Static Device Nodes in /dev<br>[   10.432340] systemd[1]: Mounting Configuration File System<br>[   10.464723] systemd[1]: Starting Apply Kernel Variables<br>[   10.511916] systemd[1]: Mounted FUSE Control File System.<br>[   10.563216] systemd[1]: Starting Syslog Socket.         </raspberrypi></p>
<p>Raspbian GNU/Linux 8 raspberrypi ttyAMA0        </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/03/14/Starting-with-your-Raspberry-Pi/" data-id="cjflnn8ba000dexpqoo379s6t" class="article-share-link">Partager</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Embeded-System/">Embeded System</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-welcome" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/09/welcome/" class="article-date">
  <time datetime="2016-03-09T18:19:17.000Z" itemprop="datePublished">2016-03-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/09/welcome/">welcome</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>welcome to scn3s realm</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/03/09/welcome/" data-id="cjflnn8bh000hexpqmind1jeh" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Mot-cls</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Embeded-System/">Embeded System</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Nuage de mot-cls</h3>
    <div class="widget tagcloud">
      <a href="/tags/Embeded-System/" style="font-size: 10px;">Embeded System</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Articles rcents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/04/04/a-python-code-shippet/">a python code shippet</a>
          </li>
        
          <li>
            <a href="/2016/06/13/Lab8/">Lab8 LED</a>
          </li>
        
          <li>
            <a href="/2016/06/13/Lab7/">Lab7 </a>
          </li>
        
          <li>
            <a href="/2016/06/13/Lab5/">Lab5 uC/OS </a>
          </li>
        
          <li>
            <a href="/2016/06/13/Lab6/">Lab6 Linux</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 scn3<br>
      Propuls by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>